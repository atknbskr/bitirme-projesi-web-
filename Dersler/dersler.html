<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dersler - Campus Summer</title>
    <link rel="stylesheet" href="anasayfa.css">
    <link rel="stylesheet" href="dersler.css">
</head>
<body>
    
    <header class="header">
        <div class="container">
            <div class="logo">
                <img src="2.3.logo.png" alt="Campus Summer Logo">
                <span>Campus Summer</span> 
            </div>
            
            <nav class="nav-menu">
                <div class="nav-item">
                    <a href="../campusumer-anasayfa/anasayfa.html" class="nav-link active">Anasayfa</a>
                </div>
                <div class="nav-item">
                    <a href="../Dersler/dersler.html" class="nav-link">Dersler</a>
                </div>
                <div class="nav-item">
                    <a href="../Ãœniversiteler/Ãœniversitler.html" class="nav-link">Ãœniversiteler</a>
                </div>
                <div class="nav-item">
                    <a href="../FakÃ¼lteler/fakÃ¼lteler.html" class="nav-link">FakÃ¼lteler</a>
                </div>
                <div class="nav-item">
                    <a href="../HakkÄ±mÄ±zda/HakkÄ±mÄ±zda.html" class="nav-link">HakkÄ±mÄ±zda</a>
                </div>
                <div class="nav-item">
                    <a href="../Ä°letiÅŸim/iletisim.html" class="nav-link">Ä°letiÅŸim</a>
                </div>
            </nav>

            
    </header>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="container">
            <div class="hero-content">
                <h1>Yaz Dersleri</h1>
                <p>200+ Ã¼niversiteden binlerce yaz dersi seÃ§eneÄŸi ile akademik hedeflerinize ulaÅŸÄ±n</p>
            </div>
        </div>
    </section>

    <!-- Akademisyen Ders Ekleme Formu -->
    <section id="academicianSection" class="academician-section" style="display: none;">
        <div class="container">
            <div class="section-header">
                <h2>Ders Ekle</h2>
                <p>Yeni bir ders ekleyin</p>
            </div>
            <div class="add-course-form-container">
                <form id="addCourseForm" class="add-course-form">
                    <div class="form-group">
                        <label for="courseName">Ders AdÄ± *</label>
                        <input type="text" id="courseName" name="courseName" required>
                    </div>
                    <div class="form-group">
                        <label for="courseCode">Ders Kodu</label>
                        <input type="text" id="courseCode" name="courseCode">
                    </div>
                    <div class="form-group">
                        <label for="category">Kategori</label>
                        <select id="category" name="category">
                            <option value="">Kategori SeÃ§in</option>
                            <option value="Matematik">Matematik</option>
                            <option value="Kimya">Kimya</option>
                            <option value="Bilgisayar Programlama">Bilgisayar Programlama</option>
                            <option value="Fizik">Fizik</option>
                            <option value="Ä°ngilizce">Ä°ngilizce</option>
                            <option value="Ä°statistik">Ä°statistik</option>
                            <option value="DiÄŸer">DiÄŸer</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="description">AÃ§Ä±klama</label>
                        <textarea id="description" name="description" rows="4"></textarea>
                    </div>
                    <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label for="applicationDeadline">ğŸ“… BaÅŸvuru Son Tarihi</label>
                            <input type="date" id="applicationDeadline" name="applicationDeadline" value="2026-06-30">
                        </div>
                        <div class="form-group">
                            <label for="startDate">ğŸ¯ BaÅŸlangÄ±Ã§ Tarihi</label>
                            <input type="date" id="startDate" name="startDate" value="2026-07-01">
                        </div>
                        <div class="form-group">
                            <label for="endDate">ğŸ BitiÅŸ Tarihi</label>
                            <input type="date" id="endDate" name="endDate" value="2026-08-31">
                        </div>
                    </div>
                    <button type="submit" class="submit-btn">Ders Ekle</button>
                    <div id="courseFormMessage" class="form-message"></div>
                </form>
            </div>
        </div>
    </section>

    <!-- Dersler Section -->
    <section class="dersler-section">
        <div class="container">
            <div class="section-header">
                <h2 id="sectionTitle">PopÃ¼ler Dersler</h2>
                <p id="sectionSubtitle">En Ã§ok tercih edilen yaz dersleri</p>
            </div>
            
            <div id="loadingMessage" class="loading-message">YÃ¼kleniyor...</div>
            <div id="derslerGrid" class="dersler-grid">
                <!-- Dersler buraya dinamik olarak eklenecek -->
            </div>
        </div>
    </section>

    <!-- Ders Detay Modal -->
    <div id="courseDetailModal" class="modal" style="display: none;">
        <div class="modal-overlay" onclick="closeCourseDetail()"></div>
        <div class="modal-content">
            <button class="modal-close" onclick="closeCourseDetail()">Ã—</button>
            <div id="modalBody" class="modal-body">
                <div class="loading-message">YÃ¼kleniyor...</div>
            </div>
        </div>
    </div>

    <style>
        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .modal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            position: relative;
            background: white;
            border-radius: 16px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease;
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #f8f9fa;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 28px;
            line-height: 1;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .modal-close:hover {
            background: #e9ecef;
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 40px;
        }

        .course-detail-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin: -40px -40px 30px -40px;
        }

        .course-detail-header h2 {
            margin: 0 0 10px 0;
            font-size: 28px;
        }

        .course-detail-header .course-code {
            background: rgba(255, 255, 255, 0.2);
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 14px;
            display: inline-block;
        }

        .detail-section {
            margin-bottom: 25px;
            padding-bottom: 25px;
            border-bottom: 1px solid #e9ecef;
        }

        .detail-section:last-child {
            border-bottom: none;
        }

        .detail-section h3 {
            color: #212529;
            margin: 0 0 15px 0;
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .detail-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
        }

        .detail-item label {
            display: block;
            font-weight: bold;
            color: #495057;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .detail-item value {
            display: block;
            color: #212529;
            font-size: 16px;
        }

        .academician-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 12px;
            margin-top: 15px;
        }

        .academician-name {
            font-size: 20px;
            font-weight: bold;
            color: #212529;
            margin-bottom: 10px;
        }

        .academician-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .academician-info-item {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #495057;
        }

        .academician-info-item strong {
            color: #212529;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 768px) {
            .modal-content {
                width: 95%;
                max-height: 95vh;
            }

            .modal-body {
                padding: 20px;
            }

            .course-detail-header {
                padding: 20px;
                margin: -20px -20px 20px -20px;
            }

            .detail-grid,
            .academician-info {
                grid-template-columns: 1fr;
            }
        }
    </style>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Campus Summer</h3>
                    <p>TÃ¼rkiye'nin en kapsamlÄ± yaz dersleri takip platformu. Akademik hedeflerinize ulaÅŸmanÄ±n en kolay yolu.</p>
                </div>
                <div class="footer-section">
                    <h3>HÄ±zlÄ± BaÄŸlantÄ±lar</h3>
                    <a href="../campusumer-anasayfa/anasayfa.html">Ana Sayfa</a>
                    <a href="../Ãœniversiteler/Ãœniversitler.html">Ãœniversiteler</a>
                    <a href="../Dersler/dersler.html">Dersler</a>
                    <a href="../HakkÄ±mÄ±zda/HakkÄ±mÄ±zda.html">HakkÄ±mÄ±zda</a>
                </div>
                <div class="footer-section">
                    <h3>Destek</h3>                    
                    <a href="../Ä°letiÅŸim/iletisim.html">Ä°letiÅŸim</a>
                    <a href="../Gizlilik-politikasÄ±/gizlilikpolitikasÄ±.html">Gizlilik PolitikasÄ±</a>
                    
                </div>
                <div class="footer-section">
                    <h3>Ä°letiÅŸim</h3>
                    <p>ğŸ“§ atakan.baskir@std.hku.edu.tr</p>
                    <p>ğŸ“ +90 506 536 1780</p>
                    <p>ğŸ“ Gaziantep, TÃ¼rkiye</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Campus Summer. TÃ¼m haklarÄ± saklÄ±dÄ±r.</p>
            </div>
        </div>
    </footer>

    <script>
        const API_URL = `${window.location.origin}/api`;
        
        // KullanÄ±cÄ± bilgilerini al
        let currentUser = null;
        let userToken = null;

        // Sayfa yÃ¼klendiÄŸinde
        document.addEventListener('DOMContentLoaded', () => {
            console.log('=== SAYFA YÃœKLENÄ°YOR ===');
            
            // LocalStorage'dan kullanÄ±cÄ± bilgilerini al
            const userStr = localStorage.getItem('user');
            userToken = localStorage.getItem('token');
            
            console.log('LocalStorage user:', userStr);
            console.log('LocalStorage token:', userToken ? 'Var' : 'Yok');
            
            if (userStr && userToken) {
                try {
                    currentUser = JSON.parse(userStr);
                    console.log('âœ… KullanÄ±cÄ± giriÅŸi tespit edildi');
                    console.log('KullanÄ±cÄ± objesi:', currentUser);
                    console.log('User Type:', currentUser.userType);
                    console.log('User Type (alternatif):', currentUser.user_type);
                    
                    // EÄŸer userType yoksa user_type'Ä± kontrol et
                    if (!currentUser.userType && currentUser.user_type) {
                        currentUser.userType = currentUser.user_type;
                        console.log('user_type kullanÄ±ldÄ±, userType gÃ¼ncellendi:', currentUser.userType);
                    }
                    
                    initializePage();
                } catch (error) {
                    console.error('âŒ KullanÄ±cÄ± bilgisi parse edilemedi:', error);
                    console.log('Raw user string:', userStr);
                    // GiriÅŸ yapÄ±lmamÄ±ÅŸ gibi davran
                    console.log('ğŸ‘¤ ZiyaretÃ§i modu - Parse hatasÄ± nedeniyle');
                    document.getElementById('sectionTitle').textContent = 'TÃ¼m Dersler';
                    document.getElementById('sectionSubtitle').textContent = 'Mevcut yaz dersleri';
                    loadCourses();
                }
            } else {
                // GiriÅŸ yapÄ±lmamÄ±ÅŸsa, ziyaretÃ§i olarak tÃ¼m dersleri gÃ¶ster
                console.log('ğŸ‘¤ ZiyaretÃ§i modu - TÃ¼m dersler gÃ¶steriliyor');
                document.getElementById('sectionTitle').textContent = 'TÃ¼m Dersler';
                document.getElementById('sectionSubtitle').textContent = 'Mevcut yaz dersleri';
                loadCourses();
            }
        });

        async function initializePage() {
            console.log('=== SAYFA BAÅLATILIYOR ===');
            console.log('Current User:', currentUser);
            console.log('User Type:', currentUser ? currentUser.userType : 'null');
            
            if (!currentUser) {
                console.error('âŒ currentUser null!');
                alert('KullanÄ±cÄ± bilgisi bulunamadÄ±. LÃ¼tfen tekrar giriÅŸ yapÄ±n.');
                return;
            }

            // Ã–nce veritabanÄ± baÄŸlantÄ±sÄ±nÄ± test et
            try {
                console.log('VeritabanÄ± baÄŸlantÄ±sÄ± test ediliyor...');
                const healthCheck = await fetch(`${API_URL}/test/db`);
                const healthData = await healthCheck.json();
                if (!healthCheck.ok) {
                    console.error('VeritabanÄ± baÄŸlantÄ± hatasÄ±:', healthData);
                    alert('VeritabanÄ± baÄŸlantÄ± hatasÄ±! LÃ¼tfen backend sunucusunun Ã§alÄ±ÅŸtÄ±ÄŸÄ±ndan ve veritabanÄ± ayarlarÄ±nÄ±n doÄŸru olduÄŸundan emin olun.');
                } else {
                    console.log('âœ… VeritabanÄ± baÄŸlantÄ±sÄ± baÅŸarÄ±lÄ±');
                }
            } catch (error) {
                console.error('Backend baÄŸlantÄ± hatasÄ±:', error);
                alert('Backend sunucusuna baÄŸlanÄ±lamadÄ±! LÃ¼tfen backend sunucusunun Ã§alÄ±ÅŸtÄ±ÄŸÄ±ndan emin olun.');
            }

            if (currentUser.userType === 'academician') {
                // Akademisyen arayÃ¼zÃ¼ - SADECE KENDÄ° DERSLERÄ°NÄ° GÃ–STER
                console.log('ğŸ“ Akademisyen modu aktif');
                document.getElementById('academicianSection').style.display = 'block';
                document.getElementById('sectionTitle').textContent = 'Benim Derslerim';
                document.getElementById('sectionSubtitle').textContent = 'Sadece sizin eklediÄŸiniz dersler gÃ¶sterilmektedir';
                setupAcademicianFeatures();
            } else if (currentUser.userType === 'student') {
                // Ã–ÄŸrenci arayÃ¼zÃ¼ - TÃœM DERSLERÄ° GÃ–STER
                console.log('ğŸ‘¨â€ğŸ“ Ã–ÄŸrenci modu aktif');
                document.getElementById('sectionTitle').textContent = 'TÃ¼m Dersler';
                document.getElementById('sectionSubtitle').textContent = 'Favorilerinize ekleyebileceÄŸiniz dersler';
                setupStudentFeatures();
            } else {
                console.warn('âš ï¸ Bilinmeyen kullanÄ±cÄ± tipi:', currentUser.userType);
            }
            
            console.log('Dersler yÃ¼kleniyor...');
            loadCourses();
        }

        function setupAcademicianFeatures() {
            // Ders ekleme formu
            document.getElementById('addCourseForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                console.log('Ders ekleme baÅŸlÄ±yor...');
                console.log('Current User:', currentUser);
                console.log('Token:', userToken ? 'Var' : 'Yok');
                
                const formData = {
                    courseName: document.getElementById('courseName').value.trim(),
                    courseCode: document.getElementById('courseCode').value.trim() || null,
                    category: document.getElementById('category').value || null,
                    description: document.getElementById('description').value.trim() || null,
                    applicationDeadline: document.getElementById('applicationDeadline').value || null,
                    startDate: document.getElementById('startDate').value || null,
                    endDate: document.getElementById('endDate').value || null
                };

                console.log('Form Data:', formData);

                try {
                    const response = await fetch(`${API_URL}/courses`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${userToken}`
                        },
                        body: JSON.stringify(formData)
                    });

                    const data = await response.json();
                    const messageDiv = document.getElementById('courseFormMessage');
                    
                    console.log('API Response:', { status: response.status, data });
                    
                    if (response.ok && data.success) {
                        messageDiv.textContent = 'âœ… Ders baÅŸarÄ±yla eklendi! Dersleriniz aÅŸaÄŸÄ±da gÃ¼ncelleniyor...';
                        messageDiv.className = 'form-message success';
                        messageDiv.style.display = 'block';
                        messageDiv.style.padding = '15px';
                        messageDiv.style.marginTop = '15px';
                        messageDiv.style.borderRadius = '8px';
                        messageDiv.style.backgroundColor = '#d4edda';
                        messageDiv.style.color = '#155724';
                        messageDiv.style.border = '1px solid #c3e6cb';
                        messageDiv.style.fontWeight = 'bold';
                        document.getElementById('addCourseForm').reset();
                        // Sadece kendi derslerini yÃ¼kle
                        setTimeout(() => {
                            messageDiv.style.display = 'none';
                            loadCourses();
                        }, 2000);
                    } else {
                        const errorMsg = data.message || `Hata: ${response.status} - ${response.statusText}`;
                        messageDiv.textContent = errorMsg;
                        messageDiv.className = 'form-message error';
                        messageDiv.style.display = 'block';
                        messageDiv.style.padding = '15px';
                        messageDiv.style.marginTop = '15px';
                        messageDiv.style.borderRadius = '8px';
                        messageDiv.style.backgroundColor = '#f8d7da';
                        messageDiv.style.color = '#721c24';
                        messageDiv.style.border = '1px solid #f5c6cb';
                        console.error('API Error:', data);
                    }
                } catch (error) {
                    console.error('Ders ekleme hatasÄ±:', error);
                    const messageDiv = document.getElementById('courseFormMessage');
                    messageDiv.textContent = `Sunucuya baÄŸlanÄ±lamadÄ±: ${error.message}`;
                    messageDiv.className = 'form-message error';
                    messageDiv.style.display = 'block';
                    messageDiv.style.padding = '15px';
                    messageDiv.style.marginTop = '15px';
                    messageDiv.style.borderRadius = '8px';
                    messageDiv.style.backgroundColor = '#f8d7da';
                    messageDiv.style.color = '#721c24';
                    messageDiv.style.border = '1px solid #f5c6cb';
                }
            });
        }

        function setupStudentFeatures() {
            // Ã–ÄŸrenci iÃ§in Ã¶zel bir ÅŸey yapmaya gerek yok, favori butonlarÄ± loadCourses iÃ§inde eklenecek
        }

        async function loadCourses() {
            const loadingDiv = document.getElementById('loadingMessage');
            const gridDiv = document.getElementById('derslerGrid');
            
            console.log('=== DERSLER YÃœKLENÄ°YOR ===');
            console.log('Current User:', currentUser);
            console.log('User Type:', currentUser ? currentUser.userType : 'null');
            console.log('User Token:', userToken ? 'Var' : 'Yok');
            console.log('API URL:', API_URL);
            
            loadingDiv.style.display = 'block';
            gridDiv.innerHTML = '';

            try {
                let url = `${API_URL}/courses`;
                let headers = { 'Content-Type': 'application/json' };

                // EÄŸer akademisyen ise, SADECE kendi derslerini getir
                if (currentUser && currentUser.userType === 'academician') {
                    url = `${API_URL}/courses/my-courses`;
                    headers['Authorization'] = `Bearer ${userToken}`;
                    console.log('ğŸ“ AKADEMÄ°SYEN: Sadece kendi dersleriniz yÃ¼kleniyor:', url);
                } else if (currentUser && currentUser.userType === 'student') {
                    // Ã–ÄŸrenci iÃ§in normal /courses endpoint'i kullan (tÃ¼m aktif dersler)
                    console.log('ğŸ‘¨â€ğŸ“ Ã–ÄRENCÄ°: TÃ¼m dersler yÃ¼kleniyor');
                    console.log('URL:', url);
                } else {
                    console.log('ğŸ‘¤ ZÄ°YARETÃ‡Ä°: TÃ¼m dersler yÃ¼kleniyor');
                    console.log('URL:', url);
                }

                console.log('Fetching from:', url);
                console.log('Headers:', headers);
                
                const response = await fetch(url, { headers });
                
                console.log('Response status:', response.status);
                console.log('Response ok:', response.ok);
                console.log('Response headers:', response.headers);
                
                if (!response.ok) {
                    let errorMessage = `API hatasÄ±: ${response.status} - ${response.statusText}`;
                    let errorDetail = '';
                    
                    try {
                        const errorData = await response.json();
                        console.error('API yanÄ±t hatasÄ± (JSON):', errorData);
                        if (errorData.message) {
                            errorMessage = errorData.message;
                        }
                        if (errorData.error) {
                            errorDetail = typeof errorData.error === 'string' 
                                ? errorData.error 
                                : JSON.stringify(errorData.error);
                        }
                    } catch (parseError) {
                        const errorText = await response.text();
                        console.error('API yanÄ±t hatasÄ± (Text):', errorText);
                        errorDetail = errorText.substring(0, 200); // Ä°lk 200 karakter
                    }
                    
                    console.error('Hata detayÄ±:', errorDetail);
                    
                    // 500 hatasÄ± iÃ§in Ã¶zel mesaj
                    if (response.status === 500) {
                        throw new Error(`Backend sunucu hatasÄ± (500). LÃ¼tfen backend konsolunu kontrol edin. ${errorDetail ? '\nDetay: ' + errorDetail : ''}`);
                    } else {
                        throw new Error(errorMessage + (errorDetail ? '\n' + errorDetail : ''));
                    }
                }
                
                const data = await response.json();
                console.log('Raw API Response:', data);
                console.log('data.success:', data.success);
                console.log('data.courses type:', typeof data.courses);
                console.log('data.courses:', data.courses);
                console.log('data.courses length:', data.courses ? data.courses.length : 'null');

                if (data.success) {
                    if (data.courses && Array.isArray(data.courses)) {
                        console.log('âœ… Toplam ders sayÄ±sÄ±:', data.courses.length);
                        if (data.courses.length === 0) {
                            console.warn('âš ï¸ HiÃ§ ders bulunamadÄ±!');
                            const emptyMessage = currentUser && currentUser.userType === 'academician' 
                                ? '<p style="grid-column: 1/-1; text-align: center; padding: 2rem; color: #666;">HenÃ¼z ders eklememiÅŸsiniz. YukarÄ±daki formdan ders ekleyebilirsiniz.</p>'
                                : '<p style="grid-column: 1/-1; text-align: center; padding: 2rem; color: #666;">HenÃ¼z ders eklenmemiÅŸ veya aktif ders bulunmuyor.</p>';
                            gridDiv.innerHTML = emptyMessage;
                        } else {
                            console.log('âœ… Dersler gÃ¶steriliyor...');
                            displayCourses(data.courses);
                        }
                    } else {
                        console.error('âŒ data.courses bir array deÄŸil:', data.courses);
                        console.error('data.courses type:', typeof data.courses);
                        gridDiv.innerHTML = '<p class="error-message" style="grid-column: 1/-1; text-align: center; color: #dc3545; padding: 2rem;">Ders verisi hatalÄ± formatta. Konsolu kontrol edin.</p>';
                    }
                } else {
                    console.error('âŒ Ders yÃ¼kleme hatasÄ±:', data);
                    gridDiv.innerHTML = '<p class="error-message" style="grid-column: 1/-1; text-align: center; color: #dc3545; padding: 2rem;">Dersler yÃ¼klenirken bir hata oluÅŸtu: ' + (data.message || 'Bilinmeyen hata') + '</p>';
                }
            } catch (error) {
                console.error('âŒ Ders yÃ¼kleme hatasÄ±:', error);
                console.error('Hata detayÄ±:', error.message);
                console.error('Stack trace:', error.stack);
                gridDiv.innerHTML = '<p class="error-message" style="grid-column: 1/-1; text-align: center; color: #dc3545; padding: 2rem;">Sunucuya baÄŸlanÄ±lamadÄ±: ' + error.message + '<br><small>LÃ¼tfen backend sunucusunun Ã§alÄ±ÅŸtÄ±ÄŸÄ±ndan emin olun.</small></p>';
            } finally {
                loadingDiv.style.display = 'none';
            }
        }

        async function displayCourses(courses) {
            const gridDiv = document.getElementById('derslerGrid');
            
            console.log('displayCourses Ã§aÄŸrÄ±ldÄ±, courses:', courses);
            
            // GÃ¼venlik kontrolÃ¼
            if (!courses || !Array.isArray(courses)) {
                console.error('Courses geÃ§erli bir array deÄŸil:', courses);
                gridDiv.innerHTML = '<p style="grid-column: 1/-1; text-align: center; padding: 2rem; color: #666;">Ders verisi hatalÄ±</p>';
                return;
            }
            
            if (courses.length === 0) {
                gridDiv.innerHTML = '<p style="grid-column: 1/-1; text-align: center; padding: 2rem; color: #666;">HenÃ¼z ders eklenmemiÅŸ</p>';
                return;
            }

            // Kategori ikonlarÄ±
            const categoryIcons = {
                'Matematik': 'ğŸ“',
                'Kimya': 'ğŸ§ª',
                'Bilgisayar Programlama': 'ğŸ’»',
                'Fizik': 'âš¡',
                'Ä°ngilizce': 'ğŸŒ',
                'Ä°statistik': 'ğŸ“Š',
                'DiÄŸer': 'ğŸ“š'
            };

            for (const course of courses) {
                const card = document.createElement('div');
                card.className = 'ders-card';
                card.dataset.courseId = course.id;

                const icon = categoryIcons[course.category] || 'ğŸ“š';
                const isMyCourse = currentUser && currentUser.userType === 'academician';
                const isStudent = currentUser && currentUser.userType === 'student';

                // Tarih formatlama
                const formatDate = (dateStr) => {
                    if (!dateStr) return 'BelirtilmemiÅŸ';
                    const date = new Date(dateStr);
                    return date.toLocaleDateString('tr-TR', { day: 'numeric', month: 'long', year: 'numeric' });
                };

                const deadlineDate = course.application_deadline ? new Date(course.application_deadline) : null;
                const today = new Date();
                const isExpired = deadlineDate && deadlineDate < today;

                card.innerHTML = `
                    <div class="ders-icon">
                        <span>${icon}</span>
                    </div>
                    <h3>${course.course_name}</h3>
                    ${course.course_code ? `<p class="course-code">${course.course_code}</p>` : ''}
                    ${isMyCourse ? `<p style="color: #28a745; font-weight: bold; font-size: 0.9em; margin: 5px 0;">âœ“ Sizin Dersiniz</p>` : ''}
                    ${isExpired ? `<p style="color: #dc3545; font-weight: bold; font-size: 0.9em; margin: 5px 0;">âš ï¸ BaÅŸvuru SÃ¼resi GeÃ§miÅŸ</p>` : ''}
                    <p>${course.description || 'AÃ§Ä±klama bulunmuyor'}</p>
                    ${course.application_deadline ? `
                        <div class="course-dates" style="background: #f8f9fa; padding: 10px; border-radius: 8px; margin: 10px 0; font-size: 0.9em;">
                            <p style="margin: 5px 0;"><strong>ğŸ“… BaÅŸvuru Son:</strong> ${formatDate(course.application_deadline)}</p>
                            ${course.start_date ? `<p style="margin: 5px 0;"><strong>ğŸ¯ BaÅŸlangÄ±Ã§:</strong> ${formatDate(course.start_date)}</p>` : ''}
                            ${course.end_date ? `<p style="margin: 5px 0;"><strong>ğŸ BitiÅŸ:</strong> ${formatDate(course.end_date)}</p>` : ''}
                        </div>
                    ` : ''}
                    <div class="ders-stats">
                        <span class="stat-item">ğŸ« ${course.university_count || 0} Ãœniversite</span>
                        <span class="stat-item">ğŸ‘¥ ${course.student_count || 0} Ã–ÄŸrenci</span>
                    </div>
                    ${!isMyCourse && course.academician_name ? `<p class="academician-name">Ã–ÄŸretmen: ${course.academician_name}</p>` : ''}
                    <div class="course-actions" style="display: flex; gap: 10px; flex-wrap: wrap;">
                        ${isMyCourse ? `
                            <button class="delete-btn" onclick="deleteCourse(${course.id})" style="background: #dc3545; flex: 1; min-width: 120px;">ğŸ—‘ï¸ Dersi Sil</button>
                        ` : ''}
                        ${isStudent && !isExpired ? `
                            <button class="favorite-btn" id="fav-${course.id}" onclick="toggleFavorite(${course.id})" style="flex: 1; min-width: 150px;">
                                <span class="fav-icon">â™¡</span> Favoriye Ekle
                            </button>
                        ` : ''}
                        ${isStudent && isExpired ? `
                            <button class="favorite-btn" disabled style="opacity: 0.5; cursor: not-allowed; flex: 1; min-width: 150px;">
                                â° BaÅŸvuru SÃ¼resi Doldu
                            </button>
                        ` : ''}
                        <button class="detail-btn" onclick="showCourseDetail(${course.id})" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; transition: all 0.3s ease; flex: 1; min-width: 120px;">
                            ğŸ“‹ Detay GÃ¶r
                        </button>
                    </div>
                `;

                gridDiv.appendChild(card);

                // Ã–ÄŸrenci ise favori durumunu kontrol et
                if (isStudent) {
                    checkFavoriteStatus(course.id);
                }
            }
        }

        async function deleteCourse(courseId) {
            if (!confirm('âš ï¸ Bu dersi kalÄ±cÄ± olarak silmek istediÄŸinize emin misiniz?\n\nBu iÅŸlem geri alÄ±namaz!')) {
                return;
            }

            try {
                console.log('Ders siliniyor, ID:', courseId);
                const response = await fetch(`${API_URL}/courses/${courseId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${userToken}`
                    }
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    // Dersi DOM'dan kaldÄ±r
                    const card = document.querySelector(`[data-course-id="${courseId}"]`);
                    if (card) {
                        // Animasyonlu silme
                        card.style.opacity = '0';
                        card.style.transform = 'scale(0.8)';
                        card.style.transition = 'all 0.3s ease';
                        setTimeout(() => {
                            card.remove();
                            // EÄŸer hiÃ§ ders kalmadÄ±ysa mesaj gÃ¶ster
                            const remainingCourses = document.querySelectorAll('.ders-card');
                            if (remainingCourses.length === 0) {
                                document.getElementById('derslerGrid').innerHTML = 
                                    '<p style="grid-column: 1/-1; text-align: center; padding: 2rem; color: #666;">HenÃ¼z ders eklememiÅŸsiniz. YukarÄ±daki formdan ders ekleyebilirsiniz.</p>';
                            }
                        }, 300);
                    }
                    alert('âœ… Ders baÅŸarÄ±yla silindi!');
                    console.log('Ders baÅŸarÄ±yla silindi');
                } else {
                    alert('âŒ Hata: ' + (data.message || 'Ders silinirken bir hata oluÅŸtu'));
                    console.error('Ders silme hatasÄ±:', data);
                }
            } catch (error) {
                console.error('Ders silme hatasÄ±:', error);
                alert('âŒ Sunucuya baÄŸlanÄ±lamadÄ±: ' + error.message);
            }
        }

        async function toggleFavorite(courseId) {
            if (!userToken) {
                alert('LÃ¼tfen Ã¶nce giriÅŸ yapÄ±n');
                return;
            }

            const favBtn = document.getElementById(`fav-${courseId}`);
            const favIcon = favBtn.querySelector('.fav-icon');
            const isFavorite = favIcon.textContent === 'â™¥';

            try {
                if (isFavorite) {
                    // Favoriden Ã§Ä±kar
                    const response = await fetch(`${API_URL}/favorites/${courseId}`, {
                        method: 'DELETE',
                        headers: {
                            'Authorization': `Bearer ${userToken}`
                        }
                    });

                    const data = await response.json();

                    if (response.ok && data.success) {
                        favIcon.textContent = 'â™¡';
                        favBtn.innerHTML = '<span class="fav-icon">â™¡</span> Favoriye Ekle';
                        updateStudentCount(courseId, -1);
                    } else {
                        alert(data.message || 'Favoriden Ã§Ä±karÄ±lÄ±rken bir hata oluÅŸtu');
                    }
                } else {
                    // Favoriye ekle
                    const response = await fetch(`${API_URL}/favorites`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${userToken}`
                        },
                        body: JSON.stringify({ courseId })
                    });

                    const data = await response.json();

                    if (response.ok && data.success) {
                        favIcon.textContent = 'â™¥';
                        favBtn.innerHTML = '<span class="fav-icon">â™¥</span> Favorilerden Ã‡Ä±kar';
                        updateStudentCount(courseId, 1);
                    } else {
                        alert(data.message || 'Favoriye eklenirken bir hata oluÅŸtu');
                    }
                }
            } catch (error) {
                console.error('Favori iÅŸlemi hatasÄ±:', error);
                alert('Sunucuya baÄŸlanÄ±lamadÄ±');
            }
        }

        async function checkFavoriteStatus(courseId) {
            if (!userToken) return;

            try {
                const response = await fetch(`${API_URL}/favorites/check/${courseId}`, {
                    headers: {
                        'Authorization': `Bearer ${userToken}`
                    }
                });

                const data = await response.json();

                if (response.ok && data.success && data.isFavorite) {
                    const favBtn = document.getElementById(`fav-${courseId}`);
                    if (favBtn) {
                        favBtn.innerHTML = '<span class="fav-icon">â™¥</span> Favorilerden Ã‡Ä±kar';
                    }
                }
            } catch (error) {
                console.error('Favori durumu kontrol hatasÄ±:', error);
            }
        }

        function updateStudentCount(courseId, change) {
            const card = document.querySelector(`[data-course-id="${courseId}"]`);
            if (!card) return;

            const statItem = card.querySelector('.stat-item:last-child');
            if (statItem) {
                const currentText = statItem.textContent;
                const match = currentText.match(/(\d+)/);
                if (match) {
                    const currentCount = parseInt(match[1]);
                    const newCount = Math.max(0, currentCount + change);
                    statItem.textContent = `ğŸ‘¥ ${newCount} Ã–ÄŸrenci`;
                }
            }
        }

        // Ders detayÄ±nÄ± gÃ¶ster
        async function showCourseDetail(courseId) {
            const modal = document.getElementById('courseDetailModal');
            const modalBody = document.getElementById('modalBody');
            
            // Modal'Ä± gÃ¶ster ve loading state
            modal.style.display = 'flex';
            modalBody.innerHTML = '<div class="loading-message" style="text-align: center; padding: 40px;">YÃ¼kleniyor...</div>';
            
            try {
                console.log('Ders detayÄ± yÃ¼kleniyor, ID:', courseId);
                const response = await fetch(`${API_URL}/courses/${courseId}/details`);
                
                if (!response.ok) {
                    throw new Error('Ders detaylarÄ± yÃ¼klenemedi');
                }
                
                const data = await response.json();
                console.log('Ders detayÄ±:', data);
                
                if (data.success && data.course) {
                    displayCourseDetail(data.course);
                } else {
                    modalBody.innerHTML = '<div class="error-message" style="text-align: center; padding: 40px; color: #dc3545;">Ders detaylarÄ± yÃ¼klenemedi</div>';
                }
            } catch (error) {
                console.error('Ders detay hatasÄ±:', error);
                modalBody.innerHTML = '<div class="error-message" style="text-align: center; padding: 40px; color: #dc3545;">Hata: ' + error.message + '</div>';
            }
        }

        // Ders detayÄ±nÄ± gÃ¶ster
        function displayCourseDetail(course) {
            const modalBody = document.getElementById('modalBody');
            
            const formatDate = (dateStr) => {
                if (!dateStr) return 'BelirtilmemiÅŸ';
                const date = new Date(dateStr);
                return date.toLocaleDateString('tr-TR', { day: 'numeric', month: 'long', year: 'numeric' });
            };

            const formatPrice = (price) => {
                if (!price || price == 0) return 'Ãœcretsiz';
                return `â‚º${parseFloat(price).toLocaleString('tr-TR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            };

            // Akademisyen bilgileri
            let academicianHTML = '';
            if (course.academician) {
                const acad = course.academician;
                academicianHTML = `
                    <div class="detail-section">
                        <h3>ğŸ‘¨â€ğŸ« Dersi Veren Akademisyen</h3>
                        <div class="academician-card">
                            <div class="academician-name">
                                ${acad.title || ''} ${acad.full_name || 'BelirtilmemiÅŸ'}
                            </div>
                            ${acad.department ? `<p style="color: #666; margin: 5px 0;">ğŸ“š ${acad.department}</p>` : ''}
                            <div class="academician-info">
                                ${acad.email ? `
                                    <div class="academician-info-item">
                                        <span>ğŸ“§</span>
                                        <div>
                                            <strong>E-posta:</strong><br>
                                            <a href="mailto:${acad.email}" style="color: #667eea;">${acad.email}</a>
                                        </div>
                                    </div>
                                ` : ''}
                                ${acad.office ? `
                                    <div class="academician-info-item">
                                        <span>ğŸ¢</span>
                                        <div>
                                            <strong>Ofis:</strong><br>
                                            ${acad.office}
                                        </div>
                                    </div>
                                ` : ''}
                                ${acad.office_hours ? `
                                    <div class="academician-info-item">
                                        <span>ğŸ•</span>
                                        <div>
                                            <strong>Ofis Saatleri:</strong><br>
                                            ${acad.office_hours}
                                        </div>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }

            modalBody.innerHTML = `
                <div class="course-detail-header">
                    <h2>${course.course_name}</h2>
                    ${course.course_code ? `<span class="course-code">${course.course_code}</span>` : ''}
                    ${course.category ? `<span class="course-code" style="margin-left: 10px;">ğŸ“š ${course.category}</span>` : ''}
                </div>

                <div class="detail-section">
                    <h3>ğŸ“ Ders HakkÄ±nda</h3>
                    <p style="line-height: 1.6; color: #495057;">${course.description || 'AÃ§Ä±klama bulunmuyor.'}</p>
                </div>

                <div class="detail-section">
                    <h3>ğŸ’° Ders Bilgileri</h3>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <label>ğŸ’µ Ãœcret</label>
                            <value style="font-size: 20px; font-weight: bold; color: #28a745;">${formatPrice(course.price)}</value>
                        </div>
                        <div class="detail-item">
                            <label>ğŸ“ Kredi</label>
                            <value>${course.credits || 3} Kredi</value>
                        </div>
                        <div class="detail-item">
                            <label>â° Ders Saati</label>
                            <value>${course.course_hours || 42} Saat</value>
                        </div>
                        <div class="detail-item">
                            <label>ğŸ‘¥ Kontenjan</label>
                            <value>${course.quota || 30} KiÅŸi</value>
                        </div>
                        <div class="detail-item">
                            <label>ğŸ“Š KayÄ±tlÄ± Ã–ÄŸrenci</label>
                            <value style="color: #667eea; font-weight: bold;">${course.student_count || 0} Ã–ÄŸrenci</value>
                        </div>
                        <div class="detail-item">
                            <label>ğŸ“ˆ Doluluk OranÄ±</label>
                            <value>${course.quota ? Math.round((course.student_count || 0) / course.quota * 100) : 0}%</value>
                        </div>
                    </div>
                </div>

                ${course.application_deadline || course.start_date || course.end_date ? `
                    <div class="detail-section">
                        <h3>ğŸ“… Ã–nemli Tarihler</h3>
                        <div class="detail-grid">
                            ${course.application_deadline ? `
                                <div class="detail-item">
                                    <label>ğŸ“ BaÅŸvuru Son Tarihi</label>
                                    <value>${formatDate(course.application_deadline)}</value>
                                </div>
                            ` : ''}
                            ${course.start_date ? `
                                <div class="detail-item">
                                    <label>ğŸ¯ BaÅŸlangÄ±Ã§ Tarihi</label>
                                    <value>${formatDate(course.start_date)}</value>
                                </div>
                            ` : ''}
                            ${course.end_date ? `
                                <div class="detail-item">
                                    <label>ğŸ BitiÅŸ Tarihi</label>
                                    <value>${formatDate(course.end_date)}</value>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                ` : ''}

                ${course.requirements ? `
                    <div class="detail-section">
                        <h3>âœ… Ã–n KoÅŸullar</h3>
                        <div style="background: #fff3cd; padding: 15px; border-radius: 8px; border-left: 4px solid #ffc107;">
                            <p style="margin: 0; color: #856404;">${course.requirements}</p>
                        </div>
                    </div>
                ` : ''}

                ${course.equivalency_info ? `
                    <div class="detail-section">
                        <h3>ğŸ”„ Denklik Bilgisi</h3>
                        <div style="background: #d1ecf1; padding: 15px; border-radius: 8px; border-left: 4px solid #17a2b8;">
                            <p style="margin: 0; color: #0c5460;">${course.equivalency_info}</p>
                        </div>
                    </div>
                ` : ''}

                ${academicianHTML}

                <div class="detail-section" style="border-bottom: none; text-align: center; padding-top: 20px;">
                    ${currentUser && currentUser.userType === 'student' && !isExpired(course.application_deadline) ? `
                        <button class="favorite-btn" onclick="toggleFavoriteFromModal(${course.id})" id="modal-fav-${course.id}" style="padding: 15px 40px; font-size: 16px;">
                            <span class="fav-icon">â™¡</span> Favoriye Ekle
                        </button>
                    ` : ''}
                    <button onclick="closeCourseDetail()" style="background: #6c757d; color: white; border: none; padding: 15px 40px; border-radius: 8px; cursor: pointer; font-weight: bold; margin-left: 10px;">
                        âŒ Kapat
                    </button>
                </div>
            `;

            // EÄŸer Ã¶ÄŸrenci ise favori durumunu kontrol et
            if (currentUser && currentUser.userType === 'student') {
                checkFavoriteStatusInModal(course.id);
            }
        }

        function isExpired(deadlineDate) {
            if (!deadlineDate) return false;
            return new Date(deadlineDate) < new Date();
        }

        // Modal'dan favori ekleme
        async function toggleFavoriteFromModal(courseId) {
            await toggleFavorite(courseId);
            // Ana sayfadaki butonu da gÃ¼ncelle
            setTimeout(() => {
                checkFavoriteStatusInModal(courseId);
            }, 500);
        }

        // Modal iÃ§indeki favori durumunu kontrol et
        async function checkFavoriteStatusInModal(courseId) {
            if (!userToken) return;

            try {
                const response = await fetch(`${API_URL}/favorites/check/${courseId}`, {
                    headers: {
                        'Authorization': `Bearer ${userToken}`
                    }
                });

                const data = await response.json();

                if (response.ok && data.success && data.isFavorite) {
                    const favBtn = document.getElementById(`modal-fav-${courseId}`);
                    if (favBtn) {
                        favBtn.innerHTML = '<span class="fav-icon">â™¥</span> Favorilerden Ã‡Ä±kar';
                    }
                }
            } catch (error) {
                console.error('Favori durumu kontrol hatasÄ±:', error);
            }
        }

        // Modal'Ä± kapat
        function closeCourseDetail() {
            const modal = document.getElementById('courseDetailModal');
            modal.style.display = 'none';
        }

        // ESC tuÅŸu ile modal'Ä± kapat
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeCourseDetail();
            }
        });
    </script>

</body>
</html>