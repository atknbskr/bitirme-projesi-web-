<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Campus Summer</title>
    <link rel="stylesheet" href="anasayfa.css" />
  </head>
  <body>
    <header class="header">
      <div class="container">
        <div class="logo">
          <img src="2.3.logo.png" alt="Campus Summer Logo" />
          <span>Campus Summer</span>
        </div>

        <nav class="nav-menu">
          <div class="nav-item">
            <a href="anasayfa.html" class="nav-link active">Anasayfa</a>
          </div>
          <div class="nav-item">
            <a href="../Dersler/dersler.html" class="nav-link">Dersler</a>
          </div>
          <div class="nav-item">
            <a href="../√úniversiteler/√úniversitler.html" class="nav-link"
              >√úniversiteler</a
            >
          </div>
          <div class="nav-item">
            <a href="../Fak√ºlteler/fak√ºlteler.html" class="nav-link"
              >Fak√ºlteler</a
            >
          </div>
          <div class="nav-item">
            <a href="../Hakkƒ±mƒ±zda/Hakkƒ±mƒ±zda.html" class="nav-link"
              >Hakkƒ±mƒ±zda</a
            >
          </div>
          <div class="nav-item">
            <a href="../ƒ∞leti≈üim/iletisim.html" class="nav-link">ƒ∞leti≈üim</a>
          </div>
        </nav>

        <!-- Saƒü Taraf: Bildirim ve Profil -->
        <div class="header-right">
          <!-- Bildirim Merkezi -->
          <div class="notification-section" id="notificationSection" style="display: none;">
            <div class="notification-icon" id="notificationToggle">
              <span id="notificationBadge" class="notification-badge" style="display: none;">0</span>
              üîî
            </div>
            <div class="notification-dropdown" id="notificationDropdown">
              <div class="notification-header">
                <h3>üîî Bildirimler</h3>
                <button class="btn-mark-all-read" id="markAllReadBtn" style="display: none;">T√ºm√ºn√º Okundu ƒ∞≈üaretle</button>
              </div>
              <div class="notification-list" id="notificationList">
                <div class="loading-message">Y√ºkleniyor...</div>
              </div>
              <div class="notification-footer">
                <a href="#" id="viewAllNotifications">T√ºm√ºn√º G√∂r</a>
              </div>
            </div>
          </div>

          <!-- Profil B√∂l√ºm√º -->
          <div class="profile-section">
          <div class="profile-avatar" id="profileToggle">
            <span id="avatarInitials">?</span>
          </div>
          <div class="profile-dropdown" id="profileDropdown">
            <div class="profile-header">
              <div class="profile-avatar-large">
                <span id="avatarInitialsLarge">?</span>
              </div>
              <div class="profile-info">
                <h4 id="profileName">Kullanƒ±cƒ±</h4>
                <p id="profileEmail">email@example.com</p>
              </div>
            </div>
            <div class="profile-details">
              <div class="profile-detail-item">
                <span class="detail-label">Kullanƒ±cƒ± Tipi:</span>
                <span class="detail-value" id="profileType">-</span>
              </div>
              <div class="profile-detail-item">
                <span class="detail-label">Okul Numarasƒ±:</span>
                <span class="detail-value" id="profileStudentNumber">-</span>
              </div>
            </div>
            <div class="profile-actions">
              <button class="btn-edit-profile" id="editProfileBtn">‚úèÔ∏è Profil D√ºzenle</button>
              <button class="btn-logout" id="logoutBtn">üö™ √áƒ±kƒ±≈ü Yap</button>
            </div>
          </div>
        </div>
        </div>
      </div>
    </header>

    <section class="hero" id="home">
      <div class="container">
        <div class="hero-content">
          <h1>T√ºrkiye'nin En Kapsamlƒ± Yaz Dersleri Platformu</h1>
          <p>200+ √ºniversiteden binlerce yaz dersi se√ßeneƒüi tek platformda.</p>
          <div class="hero-stats">
            <div class="stat">
              <div class="stat-number">200+</div>
              <div class="stat-label">√úniversite</div>
            </div>
            <div class="stat">
              <div class="stat-number">500+</div>
              <div class="stat-label">Yaz Dersi</div>
            </div>
            <div class="stat">
              <div class="stat-number">50K+</div>
              <div class="stat-label">Mutlu √ñƒürenci</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="search-section" id="search">
      <div class="container">
        <div class="search-container">
          <h2 class="search-title">ƒ∞deal Yaz Dersini Bul</h2>
          <form class="search-form" id="searchForm">
            <div class="form-group">
              <label for="university">√úniversite</label>
              <select id="university">
                <option value="">√úniversite Se√ßin</option>
              </select>
            </div>

            <div class="form-group">
              <label for="faculty">Fak√ºlte</label>
              <select id="faculty">
                <option value="">Fak√ºlte Se√ßin</option>
              </select>
            </div>

            <div class="form-group">
              <label for="language">Ders Dili</label>
              <select id="language">
                <option value="">Dil Se√ßin</option>
                <option value="Matematik">Matematik</option>
                <option value="Kimya">Kimya</option>
                <option value="Bilgisayar Programlama">Bilgisayar Programlama</option>
                <option value="Fizik">Fizik</option>
                <option value="ƒ∞ngilizce">ƒ∞ngilizce</option>
                <option value="ƒ∞statistik">ƒ∞statistik</option>
              </select>
            </div>

            <div class="form-group">
              <label for="semester">D√∂nem</label>
              <select id="semester">
                <option value="">D√∂nem Se√ßin</option>
                <option value="summer-2025">Yaz 2025</option>
                <option value="fall-2025">G√ºz 2025</option>
              </select>
            </div>

            <button type="submit" class="search-button">üîç Ders Ara</button>
          </form>
        </div>
      </div>
    </section>

    <!-- Favori Dersler Section -->
    <section class="favorite-courses-section" id="favoriteCourses" style="display: none;">
      <div class="container">
        <div class="section-header">
          <h2>‚≠ê Favori Derslerim</h2>
          <p>Se√ßtiƒüiniz yaz okulu dersleri</p>
        </div>
        <div class="favorite-courses-grid" id="favoriteCoursesGrid">
          <!-- Favori dersler dinamik olarak y√ºklenecek -->
        </div>
      </div>
    </section>

    <!-- Profil D√ºzenleme Modalƒ± -->
    <div class="modal-overlay" id="editProfileModal" style="display: none;">
      <div class="modal-container">
        <div class="modal-header">
          <h2>Profil D√ºzenle</h2>
          <button class="modal-close" id="closeModal">&times;</button>
        </div>
        <form class="modal-form" id="editProfileForm">
          <div class="form-row">
            <div class="form-group">
              <label for="editFirstName">Ad</label>
              <input
                type="text"
                id="editFirstName"
                name="firstName"
                required
              />
            </div>
            <div class="form-group">
              <label for="editLastName">Soyad</label>
              <input
                type="text"
                id="editLastName"
                name="lastName"
                required
              />
            </div>
          </div>

          <div class="form-group">
            <label for="editEmail">E-posta</label>
            <input type="email" id="editEmail" name="email" required />
          </div>

          <div class="form-group">
            <label for="editStudentNumber">Okul Numarasƒ± / Kullanƒ±cƒ± Adƒ±</label>
            <input
              type="text"
              id="editStudentNumber"
              name="studentNumber"
              readonly
            />
            <small style="color: #666;">Bu alan deƒüi≈ütirilemez</small>
          </div>

          <div class="password-section">
            <h3 style="font-size: 1.2rem; color: #333; margin-bottom: 15px;">
              ≈ûifre Deƒüi≈ütir (Opsiyonel)
            </h3>
            <div class="form-group">
              <label for="editCurrentPassword">Mevcut ≈ûifre</label>
              <input
                type="password"
                id="editCurrentPassword"
                name="currentPassword"
                placeholder="Bo≈ü bƒ±rakƒ±labilir"
              />
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="editNewPassword">Yeni ≈ûifre</label>
                <input
                  type="password"
                  id="editNewPassword"
                  name="newPassword"
                  placeholder="Bo≈ü bƒ±rakƒ±labilir"
                />
              </div>
              <div class="form-group">
                <label for="editConfirmPassword">≈ûifre Tekrar</label>
                <input
                  type="password"
                  id="editConfirmPassword"
                  name="confirmPassword"
                  placeholder="Bo≈ü bƒ±rakƒ±labilir"
                />
              </div>
            </div>
          </div>

          <div id="editErrorMessage" class="edit-error-message"></div>
          <div id="editSuccessMessage" class="edit-success-message"></div>

          <div class="modal-actions">
            <button type="button" class="btn-cancel" id="cancelEdit">
              ƒ∞ptal
            </button>
            <button type="submit" class="btn-save">Kaydet</button>
          </div>
        </form>
      </div>
    </div>

    <script>
      const API_URL = `${window.location.origin}/api`;
      let currentUser = null;
      let currentToken = null;

      // Kullanƒ±cƒ± bilgilerini y√ºkle
      function loadUserProfile() {
        const user = JSON.parse(localStorage.getItem("user"));
        const token = localStorage.getItem("token");

        if (!user || !token) {
          // Giri≈ü yapmamƒ±≈ü kullanƒ±cƒ±yƒ± giri≈ü sayfasƒ±na y√∂nlendir
          window.location.href = "../√∂ƒürenci-giri≈ü/√∂ƒürenci-giri≈ü.html";
          return;
        }

        currentUser = user;
        currentToken = token;

        // Profil bilgilerini doldur
        const initials =
          (user.firstName?.charAt(0) || "") + (user.lastName?.charAt(0) || "");
        document.getElementById("avatarInitials").textContent =
          initials.toUpperCase() || "?";
        document.getElementById("avatarInitialsLarge").textContent =
          initials.toUpperCase() || "?";
        document.getElementById("profileName").textContent = `${
          user.firstName || ""
        } ${user.lastName || ""}`;
        document.getElementById("profileEmail").textContent = user.email || "";
        document.getElementById("profileType").textContent =
          user.userType === "student" ? "√ñƒürenci" : "Akademisyen";
        document.getElementById("profileStudentNumber").textContent =
          user.studentNumber || user.username || "-";
        
        // Favori dersleri y√ºkle (sadece √∂ƒürenciler i√ßin)
        if (user.userType === "student") {
          loadFavoriteCourses();
        }
        
        // Bildirim merkezini g√∂ster ve y√ºkle
        document.getElementById("notificationSection").style.display = "block";
        loadNotifications();
        startNotificationPolling();
      }
      
      // Bildirimleri y√ºkle
      async function loadNotifications() {
        try {
          if (!currentToken) {
            console.log('Token yok, bildirimler y√ºklenemiyor');
            return;
          }
          
          console.log('Bildirimler y√ºkleniyor...');
          const response = await fetch(`${API_URL}/notifications?unreadOnly=true`, {
            headers: {
              'Authorization': `Bearer ${currentToken}`
            }
          });
          
          if (!response.ok) {
            console.error('Bildirimler y√ºkleme hatasƒ±:', response.status, response.statusText);
            const errorData = await response.json().catch(() => ({}));
            console.error('Hata detayƒ±:', errorData);
            return;
          }
          
          const data = await response.json();
          console.log('Bildirimler verisi:', data);
          
          if (data.success) {
            const unreadCount = data.unreadCount || 0;
            console.log('Okunmamƒ±≈ü bildirim sayƒ±sƒ±:', unreadCount);
            updateNotificationBadge(unreadCount);
            displayNotifications(data.data || []);
          } else {
            console.error('Bildirimler y√ºklenemedi:', data.message);
            updateNotificationBadge(0);
            displayNotifications([]);
          }
        } catch (error) {
          console.error("Bildirimler y√ºklenirken hata:", error);
          updateNotificationBadge(0);
          displayNotifications([]);
        }
      }
      
      // T√ºm bildirimleri y√ºkle (dropdown i√ßin)
      async function loadAllNotifications() {
        try {
          const response = await fetch(`${API_URL}/notifications`, {
            headers: {
              'Authorization': `Bearer ${currentToken}`
            }
          });
          
          const data = await response.json();
          
          if (data.success) {
            updateNotificationBadge(data.unreadCount || 0);
            displayNotifications(data.data || []);
          }
        } catch (error) {
          console.error("Bildirimler y√ºklenirken hata:", error);
        }
      }
      
      // Bildirim rozetini g√ºncelle
      function updateNotificationBadge(count) {
        const badge = document.getElementById("notificationBadge");
        if (count > 0) {
          badge.textContent = count > 99 ? '99+' : count;
          badge.style.display = 'block';
        } else {
          badge.style.display = 'none';
        }
      }
      
      // Bildirimleri g√∂ster
      function displayNotifications(notifications) {
        const list = document.getElementById("notificationList");
        
        if (notifications.length === 0) {
          list.innerHTML = '<div class="no-notifications">Hen√ºz bildirim yok</div>';
          document.getElementById("markAllReadBtn").style.display = 'none';
          return;
        }
        
        document.getElementById("markAllReadBtn").style.display = 'block';
        
        list.innerHTML = notifications.map(notif => {
          const formatDate = (dateStr) => {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            const now = new Date();
            const diff = now - date;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);
            
            if (minutes < 1) return 'Az √∂nce';
            if (minutes < 60) return `${minutes} dakika √∂nce`;
            if (hours < 24) return `${hours} saat √∂nce`;
            if (days < 7) return `${days} g√ºn √∂nce`;
            return date.toLocaleDateString('tr-TR', { day: 'numeric', month: 'long' });
          };
          
          const iconMap = {
            'application_approved': '‚úÖ',
            'application_rejected': '‚ùå',
            'new_application': 'üìù'
          };
          
          return `
            <div class="notification-item ${notif.is_read ? 'read' : 'unread'}" onclick="markNotificationAsRead(${notif.id})">
              <div class="notification-icon-item">${iconMap[notif.type] || 'üîî'}</div>
              <div class="notification-content">
                <div class="notification-title">${notif.title}</div>
                <div class="notification-message">${notif.message}</div>
                <div class="notification-time">${formatDate(notif.created_at)}</div>
              </div>
              ${!notif.is_read ? '<div class="notification-dot"></div>' : ''}
            </div>
          `;
        }).join('');
      }
      
      // Bildirimi okundu olarak i≈üaretle
      async function markNotificationAsRead(notificationId) {
        try {
          const response = await fetch(`${API_URL}/notifications/${notificationId}/read`, {
            method: 'PUT',
            headers: {
              'Authorization': `Bearer ${currentToken}`
            }
          });
          
          if (response.ok) {
            loadNotifications();
          }
        } catch (error) {
          console.error("Bildirim g√ºncelleme hatasƒ±:", error);
        }
      }
      
      // T√ºm bildirimleri okundu olarak i≈üaretle
      async function markAllNotificationsAsRead() {
        try {
          const response = await fetch(`${API_URL}/notifications/read-all`, {
            method: 'PUT',
            headers: {
              'Authorization': `Bearer ${currentToken}`
            }
          });
          
          if (response.ok) {
            loadNotifications();
          }
        } catch (error) {
          console.error("Bildirimler g√ºncelleme hatasƒ±:", error);
        }
      }
      
      // Bildirim polling (her 30 saniyede bir kontrol et)
      let notificationInterval;
      function startNotificationPolling() {
        if (notificationInterval) {
          clearInterval(notificationInterval);
        }
        notificationInterval = setInterval(() => {
          loadNotifications();
        }, 30000); // 30 saniye
      }
      
      function stopNotificationPolling() {
        if (notificationInterval) {
          clearInterval(notificationInterval);
        }
      }

      // √úniversiteleri y√ºkle
      async function loadUniversities() {
        try {
          const response = await fetch(`${API_URL}/universities`);
          const data = await response.json();
          
          if (data.success && data.universities) {
            const select = document.getElementById("university");
            select.innerHTML = '<option value="">√úniversite Se√ßin</option>';
            
            data.universities.forEach(uni => {
              const option = document.createElement("option");
              option.value = uni.id;
              option.textContent = uni.name;
              select.appendChild(option);
            });
          }
        } catch (error) {
          console.error("√úniversiteler y√ºklenirken hata:", error);
        }
      }

      // Fak√ºlteleri y√ºkle
      async function loadFaculties() {
        try {
          const response = await fetch(`${API_URL}/faculties`);
          const data = await response.json();
          
          if (data.success && data.faculties) {
            const select = document.getElementById("faculty");
            select.innerHTML = '<option value="">Fak√ºlte Se√ßin</option>';
            
            data.faculties.forEach(faculty => {
              const option = document.createElement("option");
              option.value = faculty.id;
              option.textContent = faculty.name;
              select.appendChild(option);
            });
          }
        } catch (error) {
          console.error("Fak√ºlteler y√ºklenirken hata:", error);
        }
      }

      // Favori dersleri y√ºkle
      async function loadFavoriteCourses() {
        try {
          const response = await fetch(`${API_URL}/favorites`, {
            headers: {
              'Authorization': `Bearer ${currentToken}`
            }
          });
          const data = await response.json();
          
          if (data.success && data.favorites && data.favorites.length > 0) {
            document.getElementById("favoriteCourses").style.display = "block";
            displayFavoriteCourses(data.favorites);
          }
        } catch (error) {
          console.error("Favori dersler y√ºklenirken hata:", error);
        }
      }

      // Favori dersleri g√∂ster
      function displayFavoriteCourses(favorites) {
        const grid = document.getElementById("favoriteCoursesGrid");
        grid.innerHTML = "";

        favorites.forEach(favorite => {
          const card = document.createElement("div");
          card.className = "favorite-course-card";
          card.innerHTML = `
            <div class="course-header">
              <h3>${favorite.course_name}</h3>
              <button class="remove-favorite-btn" onclick="removeFavorite(${favorite.id})" title="Favorilerden Kaldƒ±r">
                ‚ùå
              </button>
            </div>
            <div class="course-info">
              <p><strong>Ders Kodu:</strong> ${favorite.course_code || '-'}</p>
              <p><strong>Kategori:</strong> ${favorite.category || '-'}</p>
              <p><strong>Akademisyen:</strong> ${favorite.academician_name || 'Belirtilmemi≈ü'}</p>
            </div>
            <div class="course-meta">
              <span class="added-date">üìÖ Eklenme: ${new Date(favorite.favorited_at || favorite.created_at).toLocaleDateString('tr-TR')}</span>
            </div>
          `;
          grid.appendChild(card);
        });
      }

      // Favoriden kaldƒ±r
      async function removeFavorite(courseId) {
        if (!confirm("Bu dersi favorilerden kaldƒ±rmak istediƒüinize emin misiniz?")) {
          return;
        }

        try {
          const response = await fetch(`${API_URL}/favorites/${courseId}`, {
            method: 'DELETE',
            headers: {
              'Authorization': `Bearer ${currentToken}`
            }
          });

          const data = await response.json();

          if (data.success) {
            alert("Ders favorilerden kaldƒ±rƒ±ldƒ±!");
            loadFavoriteCourses();
          } else {
            alert(data.message || "Bir hata olu≈ütu");
          }
        } catch (error) {
          console.error("Favori kaldƒ±rma hatasƒ±:", error);
          alert("Bir hata olu≈ütu");
        }
      }

      // Arama formu submit
      document.getElementById("searchForm").addEventListener("submit", function(e) {
        e.preventDefault();
        
        const university = document.getElementById("university").value;
        const faculty = document.getElementById("faculty").value;
        const category = document.getElementById("language").value;
        
        // Dersler sayfasƒ±na y√∂nlendir (query parametreleriyle)
        let url = "../Dersler/dersler.html?";
        const params = [];
        
        if (university) params.push(`university=${university}`);
        if (faculty) params.push(`faculty=${faculty}`);
        if (category) params.push(`category=${encodeURIComponent(category)}`);
        
        url += params.join("&");
        window.location.href = url;
      });

      // Bildirim dropdown toggle
      document
        .getElementById("notificationToggle")
        .addEventListener("click", function (e) {
          e.stopPropagation();
          const dropdown = document.getElementById("notificationDropdown");
          const profileDropdown = document.getElementById("profileDropdown");
          profileDropdown.classList.remove("active");
          dropdown.classList.toggle("active");
          if (dropdown.classList.contains("active")) {
            loadAllNotifications();
          }
        });
      
      // Profil dropdown toggle
      document
        .getElementById("profileToggle")
        .addEventListener("click", function (e) {
          e.stopPropagation();
          const dropdown = document.getElementById("profileDropdown");
          const notificationDropdown = document.getElementById("notificationDropdown");
          notificationDropdown.classList.remove("active");
          dropdown.classList.toggle("active");
        });

      // Dropdown dƒ±≈üƒ±na tƒ±klanƒ±nca kapat
      document.addEventListener("click", function (e) {
        const dropdown = document.getElementById("profileDropdown");
        const notificationDropdown = document.getElementById("notificationDropdown");
        const profileSection = document.querySelector(".profile-section");
        const notificationSection = document.querySelector(".notification-section");
        
        if (!profileSection.contains(e.target)) {
          dropdown.classList.remove("active");
        }
        if (!notificationSection.contains(e.target)) {
          notificationDropdown.classList.remove("active");
        }
      });
      
      // T√ºm√ºn√º okundu i≈üaretle butonu
      document.getElementById("markAllReadBtn").addEventListener("click", function(e) {
        e.stopPropagation();
        markAllNotificationsAsRead();
      });

      // √áƒ±kƒ±≈ü yap
      document
        .getElementById("logoutBtn")
        .addEventListener("click", function () {
          localStorage.removeItem("token");
          localStorage.removeItem("user");
          // Ana giri≈ü sayfasƒ±na y√∂nlendir
          const basePath = window.location.pathname.split('/campusumer-anasayfa')[0];
          window.location.href = basePath + '/website-giri%C5%9F-sayfas%C4%B1/website-giri%C5%9F-sayfas%C4%B1.html';
        });

      // Profil D√ºzenleme Modal ƒ∞≈ülemleri
      const modal = document.getElementById("editProfileModal");
      const editProfileBtn = document.getElementById("editProfileBtn");
      const closeModalBtn = document.getElementById("closeModal");
      const cancelEditBtn = document.getElementById("cancelEdit");
      const editProfileForm = document.getElementById("editProfileForm");

      // Modal a√ßma
      editProfileBtn.addEventListener("click", function (e) {
        e.stopPropagation();
        const user = JSON.parse(localStorage.getItem("user"));
        if (user) {
          // Form alanlarƒ±nƒ± doldur
          document.getElementById("editFirstName").value = user.firstName || "";
          document.getElementById("editLastName").value = user.lastName || "";
          document.getElementById("editEmail").value = user.email || "";
          document.getElementById("editStudentNumber").value = 
            user.studentNumber || user.username || "";
          
          // ≈ûifre alanlarƒ±nƒ± temizle
          document.getElementById("editCurrentPassword").value = "";
          document.getElementById("editNewPassword").value = "";
          document.getElementById("editConfirmPassword").value = "";

          // Mesajlarƒ± temizle
          document.getElementById("editErrorMessage").style.display = "none";
          document.getElementById("editSuccessMessage").style.display = "none";

          modal.style.display = "flex";
          // Dropdown'u kapat
          document.getElementById("profileDropdown").classList.remove("active");
        }
      });

      // Modal kapama fonksiyonlarƒ±
      function closeModal() {
        modal.style.display = "none";
      }

      closeModalBtn.addEventListener("click", closeModal);
      cancelEditBtn.addEventListener("click", closeModal);

      // Modal dƒ±≈üƒ±na tƒ±klandƒ±ƒüƒ±nda kapat
      modal.addEventListener("click", function (e) {
        if (e.target === modal) {
          closeModal();
        }
      });

      // Profil g√ºncelleme formu
      editProfileForm.addEventListener("submit", async function (e) {
        e.preventDefault();

        const errorDiv = document.getElementById("editErrorMessage");
        const successDiv = document.getElementById("editSuccessMessage");
        errorDiv.style.display = "none";
        successDiv.style.display = "none";

        const user = JSON.parse(localStorage.getItem("user"));
        const token = localStorage.getItem("token");

        if (!user || !token) {
          errorDiv.textContent = "Oturum bilgisi bulunamadƒ±. L√ºtfen tekrar giri≈ü yapƒ±n.";
          errorDiv.style.display = "block";
          return;
        }

        // Form verilerini al
        const firstName = document.getElementById("editFirstName").value.trim();
        const lastName = document.getElementById("editLastName").value.trim();
        const email = document.getElementById("editEmail").value.trim();
        const currentPassword = document.getElementById("editCurrentPassword").value;
        const newPassword = document.getElementById("editNewPassword").value;
        const confirmPassword = document.getElementById("editConfirmPassword").value;

        // ≈ûifre doƒürulamasƒ±
        if (newPassword || confirmPassword) {
          if (!currentPassword) {
            errorDiv.textContent = "≈ûifre deƒüi≈ütirmek i√ßin mevcut ≈üifrenizi girmelisiniz.";
            errorDiv.style.display = "block";
            return;
          }
          if (newPassword !== confirmPassword) {
            errorDiv.textContent = "Yeni ≈üifreler e≈üle≈ümiyor.";
            errorDiv.style.display = "block";
            return;
          }
          if (newPassword.length < 6) {
            errorDiv.textContent = "Yeni ≈üifre en az 6 karakter olmalƒ±dƒ±r.";
            errorDiv.style.display = "block";
            return;
          }
        }

        // API isteƒüi i√ßin veri hazƒ±rla
        const updateData = {
          firstName,
          lastName,
          email,
        };

        if (newPassword) {
          updateData.currentPassword = currentPassword;
          updateData.newPassword = newPassword;
        }

        try {
          const API_URL = `${window.location.origin}/api`;
          const endpoint = `${API_URL}/auth/profile/update`;

          const response = await fetch(endpoint, {
            method: "PUT",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${token}`,
            },
            body: JSON.stringify(updateData),
          });

          const data = await response.json();

          if (response.ok && data.success) {
            successDiv.textContent = "Profil ba≈üarƒ±yla g√ºncellendi!";
            successDiv.style.display = "block";

            // LocalStorage'ƒ± g√ºncelle
            const updatedUser = { ...user, ...updateData };
            delete updatedUser.currentPassword;
            delete updatedUser.newPassword;
            localStorage.setItem("user", JSON.stringify(updatedUser));

            // Profil bilgilerini yeniden y√ºkle
            setTimeout(() => {
              loadUserProfile();
              closeModal();
            }, 1500);
          } else {
            errorDiv.textContent = data.message || "Profil g√ºncellenirken bir hata olu≈ütu.";
            errorDiv.style.display = "block";
          }
        } catch (error) {
          console.error("Profil g√ºncelleme hatasƒ±:", error);
          errorDiv.textContent = "Sunucuya baƒülanƒ±lamadƒ±. L√ºtfen tekrar deneyin.";
          errorDiv.style.display = "block";
        }
      });

      // Sayfa y√ºklendiƒüinde profili ve diƒüer verileri y√ºkle
      document.addEventListener("DOMContentLoaded", function() {
        loadUserProfile();
        loadUniversities();
        loadFaculties();
      });
    </script>

    <footer>
      <div class="container">
        <div class="footer-content">
          <div class="footer-section">
            <h3>Campus Summer</h3>
            <p>
              T√ºrkiye'nin en kapsamlƒ± yaz dersleri takip platformu. Akademik
              hedeflerinize ula≈ümanƒ±n en kolay yolu.
            </p>
          </div>
          <div class="footer-section">
            <h3>Hƒ±zlƒ± Baƒülantƒ±lar</h3>
            <a href="anasayfa.html">Ana Sayfa</a>
            <a href="../√úniversiteler/√úniversitler.html">√úniversiteler</a>
            <a href="../Dersler/dersler.html">Dersler</a>
            <a href="../Hakkƒ±mƒ±zda/Hakkƒ±mƒ±zda.html">Hakkƒ±mƒ±zda</a>
          </div>
          <div class="footer-section">
            <h3>Destek</h3>
            <a href="../ƒ∞leti≈üim/iletisim.html">ƒ∞leti≈üim</a>
            <a href="../Gizlilik-politikasƒ±/gizlilikpolitikasƒ±.html"
              >Gizlilik Politikasƒ±</a
            >
          </div>
          <div class="footer-section">
            <h3>ƒ∞leti≈üim</h3>
            <p>üìß atakan.baskir@std.hku.edu.tr</p>
            <p>üìû +90 506 536 1780</p>
            <p>üìç Gaziantep, T√ºrkiye</p>
          </div>
        </div>
        <div class="footer-bottom">
          <p>&copy; 2025 Campus Summer. T√ºm haklarƒ± saklƒ±dƒ±r.</p>
        </div>
      </div>
    </footer>
  </body>
</html>
