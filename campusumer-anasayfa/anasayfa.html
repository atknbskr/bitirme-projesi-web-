<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Campus Summer</title>
    <link rel="stylesheet" href="anasayfa.css" />
    <script src="../js/translations.js"></script>
  </head>
  <body>
    <header class="header">
      <div class="container">
        <div class="logo">
          <img src="2.3.logo.png" alt="Campus Summer Logo" />
          <span>Campus Summer</span>
        </div>

        <nav class="nav-menu">
          <div class="nav-item">
            <a href="anasayfa.html" class="nav-link active" data-translate="home">Anasayfa</a>
          </div>
          <div class="nav-item">
            <a href="../Dersler/dersler.html" class="nav-link" data-translate="courses">Dersler</a>
          </div>
          <div class="nav-item">
            <a href="../Ãœniversiteler/Ãœniversitler.html" class="nav-link" data-translate="universities"
              >Ãœniversiteler</a
            >
          </div>
          <div class="nav-item">
            <a href="../HakkÄ±mÄ±zda/HakkÄ±mÄ±zda.html" class="nav-link" data-translate="about"
              >HakkÄ±mÄ±zda</a
            >
          </div>
          <div class="nav-item">
            <a href="../Ä°letiÅŸim/iletisim.html" class="nav-link" data-translate="contact">Ä°letiÅŸim</a>
          </div>
        </nav>

        <!-- SaÄŸ Taraf: Dil, Bildirim ve Profil -->
        <div class="header-right">
          <!-- Dil DeÄŸiÅŸtirme Butonu -->
          <div class="changeLanguage">
            <a href="#" onclick="event.preventDefault(); changeLanguage('en');" id="englishLink">English</a>
            <a href="#" onclick="event.preventDefault(); changeLanguage('tr');" id="turkishLink" style="display: none;">TÃ¼rkÃ§e</a>
          </div>

          <!-- Bildirim Merkezi -->
          <div class="notification-section" id="notificationSection" style="display: none;">
            <div class="notification-icon" id="notificationToggle">
              <span id="notificationBadge" class="notification-badge" style="display: none;">0</span>
              ğŸ””
            </div>
            <div class="notification-dropdown" id="notificationDropdown">
              <div class="notification-header">
                <h3 data-translate="notifications">ğŸ”” Bildirimler</h3>
                <button class="btn-mark-all-read" id="markAllReadBtn" style="display: none;" data-translate="markAllRead">TÃ¼mÃ¼nÃ¼ Okundu Ä°ÅŸaretle</button>
              </div>
              <div class="notification-list" id="notificationList">
                <div class="loading-message" data-translate="loading">YÃ¼kleniyor...</div>
              </div>
              <div class="notification-footer">
                <a href="#" id="viewAllNotifications" data-translate="viewAll">TÃ¼mÃ¼nÃ¼ GÃ¶r</a>
              </div>
            </div>
          </div>

          <!-- Profil BÃ¶lÃ¼mÃ¼ -->
          <div class="profile-section">
          <div class="profile-avatar" id="profileToggle">
            <span id="avatarInitials">?</span>
          </div>
          <div class="profile-dropdown" id="profileDropdown">
            <div class="profile-header">
              <div class="profile-avatar-large">
                <span id="avatarInitialsLarge">?</span>
              </div>
              <div class="profile-info">
                <h4 id="profileName" data-translate="user">KullanÄ±cÄ±</h4>
                <p id="profileEmail">email@example.com</p>
              </div>
            </div>
            <div class="profile-details">
              <div class="profile-detail-item">
                <span class="detail-label" data-translate="userTypeLabel">KullanÄ±cÄ± Tipi:</span>
                <span class="detail-value" id="profileType">-</span>
              </div>
              <div class="profile-detail-item">
                <span class="detail-label" id="profileDetailLabel" data-translate="studentNumberLabel">Okul NumarasÄ±:</span>
                <span class="detail-value" id="profileStudentNumber">-</span>
              </div>
            </div>
            <div class="profile-actions">
              <button class="btn-edit-profile" id="editProfileBtn" data-translate="editProfile">âœï¸ Profil DÃ¼zenle</button>
              <button class="btn-logout" id="logoutBtn" data-translate="logout">ğŸšª Ã‡Ä±kÄ±ÅŸ Yap</button>
            </div>
          </div>
        </div>
        </div>
      </div>
    </header>

    <section class="hero" id="home">
      <div class="container">
        <div class="hero-content">
          <h1 data-translate="heroTitle">TÃ¼rkiye'nin En KapsamlÄ± Yaz Dersleri Platformu</h1>
          <p id="heroSubtitle" data-translate="heroSubtitle">200+ Ã¼niversiteden binlerce yaz dersi seÃ§eneÄŸi tek platformda.</p>
          <div class="hero-stats">
            <div class="stat">
              <div class="stat-number" id="heroUniversityCount">-</div>
              <div class="stat-label" data-translate="university">Ãœniversite</div>
            </div>
            <div class="stat">
              <div class="stat-number" id="heroCourseCount">-</div>
              <div class="stat-label" data-translate="summerCourse">Yaz Dersi</div>
            </div>
            <div class="stat">
              <div class="stat-number" id="heroStudentCount">-</div>
              <div class="stat-label" data-translate="happyStudent">Mutlu Ã–ÄŸrenci</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Ã–ÄŸrenci: KayÄ±tlÄ± Dersler ve Ders Planlama -->
    <section class="enrolled-courses-section" id="enrolledCoursesSection" style="display: none;">
      <div class="container">
        <div class="section-header">
          <h2 data-translate="enrolledCoursesTitle">ğŸ“š KayÄ±tlÄ± OlduÄŸum Dersler</h2>
          <p data-translate="enrolledCoursesSubtitle">OnaylanmÄ±ÅŸ ve aktif dersleriniz</p>
        </div>
        <div class="enrolled-courses-grid" id="enrolledCoursesGrid">
          <!-- KayÄ±tlÄ± dersler buraya yÃ¼klenecek -->
        </div>
      </div>
    </section>

    <!-- Akademisyen: Ä°statistikler ve HÄ±zlÄ± EriÅŸim -->
    <section class="academician-dashboard-section" id="academicianDashboardSection" style="display: none;">
      <div class="container">
        <div class="section-header">
          <h2 data-translate="academicianDashboardTitle">ğŸ“Š Akademisyen Paneli</h2>
          <p data-translate="academicianDashboardSubtitle">Derslerinizi yÃ¶netin ve baÅŸvurularÄ± takip edin</p>
        </div>
        
        <!-- Ä°statistikler -->
        <div class="academician-stats-grid" id="academicianStatsGrid">
          <!-- Ä°statistikler buraya eklenecek -->
        </div>
        
        <!-- HÄ±zlÄ± EriÅŸim ButonlarÄ± -->
        <div class="quick-actions">
          <a href="../Dersler/dersler.html" class="quick-action-btn" id="addCourseBtn" data-translate="addCourse">
            â• Yeni Ders Ekle
          </a>
          <button class="quick-action-btn" id="viewMyCoursesBtn" onclick="scrollToMyCourses()" data-translate="viewMyCourses">
            ğŸ“š Derslerimi GÃ¶rÃ¼ntÃ¼le
          </button>
          <button class="quick-action-btn" id="pendingApplicationsBtn" onclick="showPendingApplicationsModal()" data-translate="pendingApplications">
            ğŸ“‹ Bekleyen BaÅŸvurular
          </button>
        </div>
      </div>
    </section>

    <!-- Akademisyen: Benim Derslerim -->
    <section class="my-courses-section" id="myCoursesSection" style="display: none;">
      <div class="container">
        <div class="section-header">
          <h2 data-translate="myCoursesTitle">ğŸ“š Benim Derslerim</h2>
          <p data-translate="myCoursesSubtitle">EklediÄŸiniz tÃ¼m dersler</p>
        </div>
        <div class="my-courses-grid" id="myCoursesGrid">
          <!-- Akademisyenin dersleri buraya yÃ¼klenecek -->
        </div>
      </div>
    </section>

    <!-- Ã–ÄŸrenci: Ders Planlama -->
    <section class="course-planning-section" id="coursePlanningSection" style="display: none;">
      <div class="container">
        <div class="section-header">
          <h2 data-translate="coursePlanningTitle">ğŸ“… Ders Planlama</h2>
          <p data-translate="coursePlanningSubtitle">KayÄ±tlÄ± olduÄŸunuz derslerin takvimi ve planlamasÄ±</p>
        </div>
        
        <!-- Ä°statistikler -->
        <div class="planning-stats" id="planningStats">
          <!-- Ä°statistikler buraya eklenecek -->
        </div>
        
        <!-- GÃ¶rÃ¼nÃ¼m SeÃ§enekleri -->
        <div class="view-controls">
          <div class="view-tabs">
            <button class="view-tab active" data-view="calendar" onclick="switchView('calendar')" data-translate="calendar">
              ğŸ“… Takvim
            </button>
            <button class="view-tab" data-view="timeline" onclick="switchView('timeline')" data-translate="timeline">
              ğŸ“Š Zaman Ã‡izelgesi
            </button>
            <button class="view-tab" data-view="weekly" onclick="switchView('weekly')" data-translate="weekly">
              ğŸ“† HaftalÄ±k
            </button>
            <button class="view-tab" data-view="list" onclick="switchView('list')" data-translate="list">
              ğŸ“‹ Liste
            </button>
          </div>
          <div class="filter-controls">
            <select id="statusFilter" onchange="applyStatusFilter()">
              <option value="all" data-translate="allStatuses">TÃ¼m Durumlar</option>
              <option value="upcoming" data-translate="upcoming">YaklaÅŸan</option>
              <option value="active" data-translate="ongoing">Devam Eden</option>
              <option value="past" data-translate="pastLabel">Tamamlanan</option>
            </select>
          </div>
        </div>
        
        <!-- Takvim GÃ¶rÃ¼nÃ¼mÃ¼ -->
        <div class="view-container" id="calendarViewContainer">
          <div class="calendar-view" id="calendarView">
            <!-- Takvim gÃ¶rÃ¼nÃ¼mÃ¼ buraya eklenecek -->
          </div>
        </div>
        
        <!-- Zaman Ã‡izelgesi GÃ¶rÃ¼nÃ¼mÃ¼ -->
        <div class="view-container" id="timelineViewContainer" style="display: none;">
          <div class="course-timeline" id="courseTimeline">
            <!-- Ders zaman Ã§izelgesi buraya eklenecek -->
          </div>
        </div>
        
        <!-- HaftalÄ±k GÃ¶rÃ¼nÃ¼m -->
        <div class="view-container" id="weeklyViewContainer" style="display: none;">
          <div class="weekly-view" id="weeklyView">
            <!-- HaftalÄ±k gÃ¶rÃ¼nÃ¼m buraya eklenecek -->
          </div>
        </div>
        
        <!-- Liste GÃ¶rÃ¼nÃ¼mÃ¼ -->
        <div class="view-container" id="listViewContainer" style="display: none;">
          <div class="list-view" id="listView">
            <!-- Liste gÃ¶rÃ¼nÃ¼mÃ¼ buraya eklenecek -->
          </div>
        </div>
      </div>
    </section>

    <!-- Favori Dersler Section -->
    <section class="favorite-courses-section" id="favoriteCourses" style="display: none;">
      <div class="container">
        <div class="section-header">
          <h2 data-translate="favoriteCoursesTitle">â­ Favori Derslerim</h2>
          <p data-translate="favoriteCoursesSubtitle">SeÃ§tiÄŸiniz yaz okulu dersleri</p>
        </div>
        <div class="favorite-courses-grid" id="favoriteCoursesGrid">
          <!-- Favori dersler dinamik olarak yÃ¼klenecek -->
        </div>
      </div>
    </section>

    <!-- Bekleyen BaÅŸvurular ModalÄ± -->
    <div class="modal-overlay" id="pendingApplicationsModal" style="display: none;">
      <div class="modal-container" style="max-width: 800px;">
        <div class="modal-header">
          <h2 data-translate="pendingApplicationsTitle">ğŸ“‹ Bekleyen BaÅŸvurular</h2>
          <button class="modal-close" onclick="closePendingApplicationsModal()">&times;</button>
        </div>
        <div class="modal-body" id="pendingApplicationsModalBody">
          <!-- Bekleyen baÅŸvurular buraya yÃ¼klenecek -->
        </div>
      </div>
    </div>

    <!-- Profil DÃ¼zenleme ModalÄ± -->
    <div class="modal-overlay" id="editProfileModal" style="display: none;">
      <div class="modal-container">
        <div class="modal-header">
          <h2 data-translate="editProfileTitle">Profil DÃ¼zenle</h2>
          <button class="modal-close" id="closeModal">&times;</button>
        </div>
        <form class="modal-form" id="editProfileForm">
          <div class="form-row">
            <div class="form-group">
              <label for="editFirstName" data-translate="firstName">Ad</label>
              <input
                type="text"
                id="editFirstName"
                name="firstName"
                required
              />
            </div>
            <div class="form-group">
              <label for="editLastName" data-translate="lastName">Soyad</label>
              <input
                type="text"
                id="editLastName"
                name="lastName"
                required
              />
            </div>
          </div>

          <div class="form-group">
            <label for="editEmail" data-translate="email">E-posta</label>
            <input type="email" id="editEmail" name="email" required />
          </div>

          <div class="form-group" id="identifierGroup">
            <label for="editIdentifier" id="identifierLabel">Okul NumarasÄ± / KullanÄ±cÄ± AdÄ±</label>
            <input
              type="text"
              id="editIdentifier"
              name="identifier"
              readonly
            />
            <small style="color: #666;" id="identifierHelp" data-translate="cannotChangeField">Bu alan deÄŸiÅŸtirilemez</small>
          </div>

          <div class="password-section">
            <h3 style="font-size: 1.2rem; color: #333; margin-bottom: 15px;" data-translate="changePassword">
              Åifre DeÄŸiÅŸtir (Opsiyonel)
            </h3>
            <div class="form-group">
              <label for="editCurrentPassword" data-translate="currentPassword">Mevcut Åifre</label>
              <input
                type="password"
                id="editCurrentPassword"
                name="currentPassword"
                data-translate-placeholder="passwordPlaceholder"
                placeholder="BoÅŸ bÄ±rakÄ±labilir"
              />
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="editNewPassword" data-translate="newPassword">Yeni Åifre</label>
                <input
                  type="password"
                  id="editNewPassword"
                  name="newPassword"
                  data-translate-placeholder="passwordPlaceholder"
                  placeholder="BoÅŸ bÄ±rakÄ±labilir"
                />
              </div>
              <div class="form-group">
                <label for="editConfirmPassword" data-translate="confirmPassword">Åifre Tekrar</label>
                <input
                  type="password"
                  id="editConfirmPassword"
                  name="confirmPassword"
                  data-translate-placeholder="passwordPlaceholder"
                  placeholder="BoÅŸ bÄ±rakÄ±labilir"
                />
              </div>
            </div>
          </div>

          <div id="editErrorMessage" class="edit-error-message"></div>
          <div id="editSuccessMessage" class="edit-success-message"></div>

          <div class="modal-actions">
            <button type="button" class="btn-cancel" id="cancelEdit" data-translate="cancel">
              Ä°ptal
            </button>
            <button type="submit" class="btn-save" data-translate="save">Kaydet</button>
          </div>
        </form>
      </div>
    </div>

    <script>
      const API_URL = `${window.location.origin}/api`;
      let currentUser = null;
      let currentToken = null;

      // KullanÄ±cÄ± bilgilerini yÃ¼kle
      function loadUserProfile() {
        const user = JSON.parse(localStorage.getItem("user"));
        const token = localStorage.getItem("token");

        if (!user || !token) {
          // GiriÅŸ yapmamÄ±ÅŸ kullanÄ±cÄ±yÄ± giriÅŸ sayfasÄ±na yÃ¶nlendir
          window.location.href = "../Ã¶ÄŸrenci-giriÅŸ/Ã¶ÄŸrenci-giriÅŸ.html";
          return;
        }

        currentUser = user;
        currentToken = token;

        // Profil bilgilerini doldur
        const initials =
          (user.firstName?.charAt(0) || "") + (user.lastName?.charAt(0) || "");
        document.getElementById("avatarInitials").textContent =
          initials.toUpperCase() || "?";
        document.getElementById("avatarInitialsLarge").textContent =
          initials.toUpperCase() || "?";
        document.getElementById("profileName").textContent = `${
          user.firstName || ""
        } ${user.lastName || ""}`;
        document.getElementById("profileEmail").textContent = user.email || "";
        
        const currentLang = getCurrentLanguage();
        document.getElementById("profileType").textContent =
          user.userType === "student" ? t('student', currentLang) : t('academician', currentLang);
        
        // KullanÄ±cÄ± tipine gÃ¶re label ve deÄŸeri ayarla
        const profileDetailLabel = document.getElementById("profileDetailLabel");
        const profileStudentNumber = document.getElementById("profileStudentNumber");
        
        if (user.userType === "academician") {
          profileDetailLabel.textContent = t('usernameLabel', currentLang);
          profileStudentNumber.textContent = user.username || "-";
        } else if (user.userType === "student") {
          profileDetailLabel.textContent = t('studentNumberLabel', currentLang);
          profileStudentNumber.textContent = user.studentNumber || "-";
        } else {
          profileDetailLabel.textContent = t('usernameLabel', currentLang);
          profileStudentNumber.textContent = user.username || "-";
        }
        
        // Ã–ÄŸrenci iÃ§in Ã¶zel iÅŸlemler
        if (user.userType === "student") {
          loadFavoriteCourses();
          loadEnrolledCourses();
          loadCoursePlanning();
          document.getElementById("enrolledCoursesSection").style.display = "block";
          document.getElementById("coursePlanningSection").style.display = "block";
        }
        
        // Akademisyen iÃ§in Ã¶zel iÅŸlemler
        if (user.userType === "academician") {
          loadAcademicianDashboard();
          loadMyCourses();
          document.getElementById("academicianDashboardSection").style.display = "block";
          document.getElementById("myCoursesSection").style.display = "block";
        }
        
        // Bildirim merkezini gÃ¶ster ve yÃ¼kle
        document.getElementById("notificationSection").style.display = "block";
        loadNotifications();
        startNotificationPolling();
      }
      
      // Ã–ÄŸrencinin kayÄ±tlÄ± olduÄŸu dersleri yÃ¼kle
      async function loadEnrolledCourses() {
        try {
          const response = await fetch(`${API_URL}/student-courses/my-courses`, {
            headers: {
              'Authorization': `Bearer ${currentToken}`
            }
          });
          
          const data = await response.json();
          
          // Backend'den data veya courses dÃ¶nebilir
          const courses = data.data || data.courses || [];
          
          if (data.success && courses.length > 0) {
            displayEnrolledCourses(courses);
          } else {
            const currentLang = getCurrentLanguage();
            document.getElementById("enrolledCoursesGrid").innerHTML = 
              `<p style="text-align: center; padding: 2rem; color: #666;">${t('noEnrolledCourses', currentLang)} <a href="../Dersler/dersler.html" style="color: #667eea;">${t('browseCourses', currentLang)}</a></p>`;
          }
        } catch (error) {
          console.error("KayÄ±tlÄ± dersler yÃ¼klenirken hata:", error);
          const currentLang = getCurrentLanguage();
          document.getElementById("enrolledCoursesGrid").innerHTML = 
            `<p style="text-align: center; padding: 2rem; color: #dc3545;">${t('errorLoadingCourses', currentLang)}</p>`;
        }
      }
      
      // KayÄ±tlÄ± dersleri gÃ¶ster
      function displayEnrolledCourses(courses) {
        const grid = document.getElementById("enrolledCoursesGrid");
        grid.innerHTML = "";
        const currentLang = getCurrentLanguage();
        
        courses.forEach(course => {
          const formatDate = (dateStr) => {
            if (!dateStr) return currentLang === 'tr' ? 'BelirtilmemiÅŸ' : 'Not specified';
            const date = new Date(dateStr);
            const locale = currentLang === 'tr' ? 'tr-TR' : 'en-US';
            return date.toLocaleDateString(locale, { 
              day: 'numeric', 
              month: 'long', 
              year: 'numeric' 
            });
          };
          
          const card = document.createElement("div");
          card.className = "enrolled-course-card";
          const statusText = course.status === 'active' 
            ? (currentLang === 'tr' ? 'âœ… Aktif' : 'âœ… Active')
            : (currentLang === 'tr' ? course.status : course.status);
          
          card.innerHTML = `
            <div class="course-header">
              <h3>${course.course_name || (currentLang === 'tr' ? 'Ders AdÄ±' : 'Course Name')}</h3>
              ${course.course_code ? `<span class="course-code">${course.course_code}</span>` : ''}
            </div>
            <div class="course-info">
              ${course.university_name ? `<p><strong>ğŸ›ï¸ ${t('universityLabel', currentLang)}</strong> ${course.university_name}</p>` : ''}
              ${course.academician_name ? `<p><strong>ğŸ‘¨â€ğŸ« ${t('academicianLabel', currentLang)}</strong> ${course.academician_title ? course.academician_title + ' ' : ''}${course.academician_name}</p>` : ''}
              ${course.start_date ? `<p><strong>ğŸ¯ ${t('startLabel', currentLang)}</strong> ${formatDate(course.start_date)}</p>` : ''}
              ${course.end_date ? `<p><strong>ğŸ ${t('endLabel', currentLang)}</strong> ${formatDate(course.end_date)}</p>` : ''}
              ${course.credits ? `<p><strong>ğŸ“š ${t('creditsLabel', currentLang)}</strong> ${course.credits}</p>` : ''}
              ${course.status ? `<p><strong>ğŸ“Š ${t('statusLabel', currentLang)}</strong> <span class="status-badge status-${course.status}">${statusText}</span></p>` : ''}
            </div>
            <div class="course-actions">
              ${course.udemy_link ? `
                <a href="${course.udemy_link}" target="_blank" class="btn-course-link">
                  ğŸ”— ${t('courseLink', currentLang)}
                </a>
              ` : `
                <p style="color: #999; font-style: italic; text-align: center; padding: 10px;">
                  ${t('courseLinkNotAdded', currentLang)}
                </p>
              `}
              ${course.status === 'active' ? `
                <button onclick="withdrawFromCourse(${course.id})" class="btn-withdraw-course" style="background: #dc3545; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 10px; transition: all 0.3s ease;">
                  âŒ ${t('cancelCourse', currentLang)}
                </button>
              ` : ''}
            </div>
          `;
          grid.appendChild(card);
        });
      }
      
      // Ders planlamasÄ±nÄ± yÃ¼kle
      async function loadCoursePlanning() {
        try {
          const response = await fetch(`${API_URL}/student-courses/my-courses`, {
            headers: {
              'Authorization': `Bearer ${currentToken}`
            }
          });
          
          const data = await response.json();
          
          // Backend'den data veya courses dÃ¶nebilir
          const courses = data.data || data.courses || [];
          
          if (data.success && courses.length > 0) {
            displayCoursePlanning(courses);
          } else {
            const currentLang = getCurrentLanguage();
            document.getElementById("courseTimeline").innerHTML = 
              `<p style="text-align: center; padding: 2rem; color: #666;">${t('noCoursesToPlan', currentLang)}</p>`;
          }
        } catch (error) {
          console.error("Ders planlama yÃ¼klenirken hata:", error);
          const currentLang = getCurrentLanguage();
          document.getElementById("courseTimeline").innerHTML = 
            `<p style="text-align: center; padding: 2rem; color: #dc3545;">${t('errorLoadingPlanning', currentLang)}</p>`;
        }
      }
      
      // Global deÄŸiÅŸkenler
      let allCoursesData = [];
      let currentCalendarMonth = new Date().getMonth();
      let currentCalendarYear = new Date().getFullYear();
      let currentView = 'calendar';
      let currentStatusFilter = 'all';
      let currentWeekStart = new Date();
      currentWeekStart.setDate(currentWeekStart.getDate() - currentWeekStart.getDay() + 1); // Pazartesi
      
      // Ders planlamasÄ±nÄ± gÃ¶ster
      function displayCoursePlanning(courses) {
        allCoursesData = courses;
        
        // Ä°statistikleri gÃ¶ster
        displayPlanningStats(courses);
        
        // Ä°lk gÃ¶rÃ¼nÃ¼mÃ¼ gÃ¶ster (takvim)
        if (currentView === 'calendar') {
          switchView('calendar');
        } else {
          switchView('timeline');
        }
      }
      
      // Ä°statistikleri gÃ¶ster
      function displayPlanningStats(courses) {
        const now = new Date();
        let upcoming = 0, active = 0, past = 0;
        let totalCredits = 0;
        const currentLang = getCurrentLanguage();
        
        courses.forEach(course => {
          if (course.start_date) {
            const startDate = new Date(course.start_date);
            const endDate = course.end_date ? new Date(course.end_date) : null;
            
            if (startDate > now) {
              upcoming++;
            } else if (startDate <= now && (!endDate || endDate >= now)) {
              active++;
            } else if (endDate && endDate < now) {
              past++;
            }
          }
          if (course.credits) {
            totalCredits += parseInt(course.credits) || 0;
          }
        });
        
        const statsHTML = `
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-icon">ğŸ“š</div>
              <div class="stat-value">${courses.length}</div>
              <div class="stat-label">${t('totalCourseLabel', currentLang)}</div>
            </div>
            <div class="stat-card stat-upcoming">
              <div class="stat-icon">â°</div>
              <div class="stat-value">${upcoming}</div>
              <div class="stat-label">${t('upcomingLabel', currentLang)}</div>
            </div>
            <div class="stat-card stat-active">
              <div class="stat-icon">âœ…</div>
              <div class="stat-value">${active}</div>
              <div class="stat-label">${t('ongoingLabel', currentLang)}</div>
            </div>
            <div class="stat-card stat-past">
              <div class="stat-icon">ğŸ“</div>
              <div class="stat-value">${past}</div>
              <div class="stat-label">${t('pastLabel', currentLang)}</div>
            </div>
            <div class="stat-card stat-credits">
              <div class="stat-icon">ğŸ“Š</div>
              <div class="stat-value">${totalCredits}</div>
              <div class="stat-label">${t('totalCreditsLabel', currentLang)}</div>
            </div>
          </div>
        `;
        
        document.getElementById("planningStats").innerHTML = statsHTML;
      }
      
      // Durum filtresini uygula
      function applyStatusFilter() {
        currentStatusFilter = document.getElementById("statusFilter").value;
        const filteredCourses = getFilteredCourses();
        
        // Mevcut gÃ¶rÃ¼nÃ¼me gÃ¶re gÃ¶ster
        switch(currentView) {
          case 'calendar':
            displayCalendarView(filteredCourses);
            break;
          case 'timeline':
            displayTimelineView(filteredCourses);
            break;
          case 'weekly':
            displayWeeklyView(filteredCourses);
            break;
          case 'list':
            displayListView(filteredCourses);
            break;
        }
      }
      
      // FiltrelenmiÅŸ dersleri al
      function getFilteredCourses() {
        const now = new Date();
        let filtered = allCoursesData.filter(c => c.start_date);
        
        if (currentStatusFilter === 'all') {
          return filtered;
        }
        
        return filtered.filter(course => {
          const startDate = new Date(course.start_date);
          const endDate = course.end_date ? new Date(course.end_date) : null;
          
          if (currentStatusFilter === 'upcoming') {
            return startDate > now;
          } else if (currentStatusFilter === 'active') {
            return startDate <= now && (!endDate || endDate >= now);
          } else if (currentStatusFilter === 'past') {
            return endDate && endDate < now;
          }
          return true;
        });
      }
      
      // GÃ¶rÃ¼nÃ¼m deÄŸiÅŸtir
      function switchView(view) {
        currentView = view;
        
        // TÃ¼m gÃ¶rÃ¼nÃ¼mleri gizle
        document.querySelectorAll('.view-container').forEach(container => {
          container.style.display = 'none';
        });
        
        // TÃ¼m tab'larÄ± pasif yap
        document.querySelectorAll('.view-tab').forEach(tab => {
          tab.classList.remove('active');
        });
        
        // SeÃ§ili gÃ¶rÃ¼nÃ¼mÃ¼ gÃ¶ster
        document.getElementById(`${view}ViewContainer`).style.display = 'block';
        document.querySelector(`[data-view="${view}"]`).classList.add('active');
        
        // GÃ¶rÃ¼nÃ¼mÃ¼ oluÅŸtur
        const filteredCourses = getFilteredCourses();
        switch(view) {
          case 'calendar':
            displayCalendarView(filteredCourses);
            break;
          case 'timeline':
            displayTimelineView(filteredCourses);
            break;
          case 'weekly':
            displayWeeklyView(filteredCourses);
            break;
          case 'list':
            displayListView(filteredCourses);
            break;
        }
      }
      
      // Zaman Ã§izelgesi gÃ¶rÃ¼nÃ¼mÃ¼
      function displayTimelineView(courses) {
        const timeline = document.getElementById("courseTimeline");
        
        const sortedCourses = courses.sort((a, b) => new Date(a.start_date) - new Date(b.start_date));
        
        const currentLang = getCurrentLanguage();
        const locale = currentLang === 'tr' ? 'tr-TR' : 'en-US';
        
        if (sortedCourses.length === 0) {
          timeline.innerHTML = `<p style="text-align: center; padding: 2rem; color: #666;">${t('noCourses', currentLang)}</p>`;
          return;
        }
        
        let timelineHTML = '<div class="timeline-container">';
        
        sortedCourses.forEach((course, index) => {
          const startDate = new Date(course.start_date);
          const endDate = course.end_date ? new Date(course.end_date) : null;
          const now = new Date();
          
          const isUpcoming = startDate > now;
          const isActive = startDate <= now && (!endDate || endDate >= now);
          const isPast = endDate && endDate < now;
          
          let statusClass = 'upcoming';
          let statusText = t('upcomingStatus', currentLang);
          if (isActive) {
            statusClass = 'active';
            statusText = t('ongoingStatus', currentLang);
          } else if (isPast) {
            statusClass = 'past';
            statusText = t('completedStatus', currentLang);
          }
          
          const daysUntil = isUpcoming ? Math.ceil((startDate - now) / (1000 * 60 * 60 * 24)) : null;
          
          // Ä°lerleme yÃ¼zdesi
          let progressPercent = 0;
          if (endDate && startDate) {
            const totalDays = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24));
            const passedDays = Math.ceil((now - startDate) / (1000 * 60 * 60 * 24));
            progressPercent = Math.max(0, Math.min(100, (passedDays / totalDays) * 100));
          }
          
          timelineHTML += `
            <div class="timeline-item ${statusClass}">
              <div class="timeline-marker"></div>
              <div class="timeline-content">
                <div class="timeline-header">
                  <h4>${course.course_name || (currentLang === 'tr' ? 'Ders' : 'Course')}</h4>
                  <span class="timeline-status status-${statusClass}">${statusText}</span>
                </div>
                ${course.course_code ? `<p class="course-code-small">${course.course_code}</p>` : ''}
                <div class="timeline-dates">
                  <p><strong>ğŸ¯ ${t('startLabel', currentLang)}</strong> ${startDate.toLocaleDateString(locale, { day: 'numeric', month: 'long', year: 'numeric' })}</p>
                  ${endDate ? `<p><strong>ğŸ ${t('endLabel', currentLang)}</strong> ${endDate.toLocaleDateString(locale, { day: 'numeric', month: 'long', year: 'numeric' })}</p>` : ''}
                  ${daysUntil !== null && daysUntil > 0 ? `<p class="days-until"><strong>â° ${t('daysRemaining', currentLang)}</strong> ${daysUntil} ${t('days', currentLang)}</p>` : ''}
                  ${course.credits ? `<p><strong>ğŸ“š ${t('creditsLabel', currentLang)}</strong> ${course.credits}</p>` : ''}
                </div>
                ${isActive && endDate ? `
                  <div class="progress-bar-container">
                    <div class="progress-bar">
                      <div class="progress-fill" style="width: ${progressPercent}%"></div>
                    </div>
                    <span class="progress-text">%${Math.round(progressPercent)} ${t('completedPercent', currentLang)}</span>
                  </div>
                ` : ''}
                ${course.university_name ? `<p class="university-name">ğŸ›ï¸ ${course.university_name}</p>` : ''}
              </div>
            </div>
          `;
        });
        
        timelineHTML += '</div>';
        timeline.innerHTML = timelineHTML;
      }
      
      // Takvim gÃ¶rÃ¼nÃ¼mÃ¼
      function displayCalendarView(courses) {
        const calendar = document.getElementById("calendarView");
        const currentLang = getCurrentLanguage();
        
        // Ay isimleri
        const monthNames = currentLang === 'tr' 
          ? ['Ocak', 'Åubat', 'Mart', 'Nisan', 'MayÄ±s', 'Haziran', 
             'Temmuz', 'AÄŸustos', 'EylÃ¼l', 'Ekim', 'KasÄ±m', 'AralÄ±k']
          : ['January', 'February', 'March', 'April', 'May', 'June',
             'July', 'August', 'September', 'October', 'November', 'December'];
        
        // Hafta gÃ¼nleri
        const dayNames = currentLang === 'tr'
          ? ['Pzt', 'Sal', 'Ã‡ar', 'Per', 'Cum', 'Cmt', 'Paz']
          : ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
        
        // AyÄ±n ilk gÃ¼nÃ¼ ve gÃ¼n sayÄ±sÄ±
        const firstDay = new Date(currentCalendarYear, currentCalendarMonth, 1).getDay();
        const daysInMonth = new Date(currentCalendarYear, currentCalendarMonth + 1, 0).getDate();
        const now = new Date();
        
        // Dersleri tarihe gÃ¶re grupla (tÃ¼m tarih aralÄ±ÄŸÄ±)
        const coursesByDate = {};
        courses.forEach(course => {
          if (course.start_date) {
            const startDate = new Date(course.start_date);
            const endDate = course.end_date ? new Date(course.end_date) : startDate;
            
            // Ders sÃ¼resince her gÃ¼nÃ¼ iÅŸaretle
            for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
              if (d.getMonth() === currentCalendarMonth && d.getFullYear() === currentCalendarYear) {
                const dateKey = `${d.getFullYear()}-${d.getMonth()}-${d.getDate()}`;
                if (!coursesByDate[dateKey]) {
                  coursesByDate[dateKey] = [];
                }
                if (!coursesByDate[dateKey].find(c => c.id === course.id)) {
                  coursesByDate[dateKey].push(course);
                }
              }
            }
          }
        });
        
        let calendarHTML = `
          <div class="calendar-header">
            <button class="calendar-nav-btn" onclick="changeMonth(-1)">â† ${t('previousMonth', currentLang)}</button>
            <h3>${monthNames[currentCalendarMonth]} ${currentCalendarYear}</h3>
            <button class="calendar-nav-btn" onclick="changeMonth(1)">${t('nextMonth', currentLang)} â†’</button>
          </div>
          <div class="calendar-grid">
            <div class="calendar-weekdays">
              ${dayNames.map(day => `<div class="calendar-weekday">${day}</div>`).join('')}
            </div>
            <div class="calendar-days">
        `;
        
        // BoÅŸ gÃ¼nler (Pazartesi baÅŸlangÄ±cÄ± iÃ§in dÃ¼zeltme)
        const adjustedFirstDay = firstDay === 0 ? 6 : firstDay - 1;
        for (let i = 0; i < adjustedFirstDay; i++) {
          calendarHTML += '<div class="calendar-day empty"></div>';
        }
        
        // AyÄ±n gÃ¼nleri
        for (let day = 1; day <= daysInMonth; day++) {
          const dateKey = `${currentCalendarYear}-${currentCalendarMonth}-${day}`;
          const dayCourses = coursesByDate[dateKey] || [];
          const isToday = day === now.getDate() && currentCalendarMonth === now.getMonth() && currentCalendarYear === now.getFullYear();
          
          calendarHTML += `
            <div class="calendar-day ${isToday ? 'today' : ''} ${dayCourses.length > 0 ? 'has-courses' : ''}" onclick="showDayDetails(${day}, ${currentCalendarMonth}, ${currentCalendarYear})">
              <div class="day-number">${day}</div>
              ${dayCourses.length > 0 ? `
                <div class="day-courses">
                  ${dayCourses.slice(0, 2).map(course => `
                    <div class="day-course-item" style="background: ${getCourseColor(course)}" title="${course.course_name}">
                      ${course.course_code || course.course_name.substring(0, 3)}
                    </div>
                  `).join('')}
                  ${dayCourses.length > 2 ? `<div class="day-course-more">+${dayCourses.length - 2}</div>` : ''}
                </div>
              ` : ''}
            </div>
          `;
        }
        
        calendarHTML += `
            </div>
          </div>
        `;
        
        calendar.innerHTML = calendarHTML;
      }
      
      // Ay deÄŸiÅŸtir
      function changeMonth(direction) {
        currentCalendarMonth += direction;
        if (currentCalendarMonth < 0) {
          currentCalendarMonth = 11;
          currentCalendarYear--;
        } else if (currentCalendarMonth > 11) {
          currentCalendarMonth = 0;
          currentCalendarYear++;
        }
        displayCalendarView(getFilteredCourses());
      }
      
      // Ders rengi al
      function getCourseColor(course) {
        const now = new Date();
        const startDate = new Date(course.start_date);
        const endDate = course.end_date ? new Date(course.end_date) : null;
        
        if (startDate > now) return '#ffc107'; // YaklaÅŸan - sarÄ±
        if (startDate <= now && (!endDate || endDate >= now)) return '#28a745'; // Aktif - yeÅŸil
        return '#6c757d'; // Tamamlanan - gri
      }
      
      // GÃ¼n detaylarÄ±nÄ± gÃ¶ster
      function showDayDetails(day, month, year) {
        const date = new Date(year, month, day);
        const dateKey = `${year}-${month}-${day}`;
        const coursesByDate = {};
        
        getFilteredCourses().forEach(course => {
          if (course.start_date) {
            const startDate = new Date(course.start_date);
            const endDate = course.end_date ? new Date(course.end_date) : startDate;
            
            if (date >= startDate && date <= endDate) {
              if (!coursesByDate[dateKey]) {
                coursesByDate[dateKey] = [];
              }
              coursesByDate[dateKey].push(course);
            }
          }
        });
        
        const dayCourses = coursesByDate[dateKey] || [];
        if (dayCourses.length > 0) {
          const currentLang = getCurrentLanguage();
          const locale = currentLang === 'tr' ? 'tr-TR' : 'en-US';
          const courseList = dayCourses.map(c => `â€¢ ${c.course_name}${c.course_code ? ` (${c.course_code})` : ''}`).join('\\n');
          const todayCoursesText = currentLang === 'tr' ? 'Bu gÃ¼nkÃ¼ dersler:' : 'Today\'s courses:';
          alert(`${date.toLocaleDateString(locale, { day: 'numeric', month: 'long', year: 'numeric' })}\\n\\n${todayCoursesText}\\n${courseList}`);
        }
      }
      
      // HaftalÄ±k gÃ¶rÃ¼nÃ¼m
      function displayWeeklyView(courses) {
        const weeklyView = document.getElementById("weeklyView");
        const now = new Date();
        
        const weekDays = [];
        for (let i = 0; i < 7; i++) {
          const day = new Date(currentWeekStart);
          day.setDate(currentWeekStart.getDate() + i);
          weekDays.push(day);
        }
        
        const currentLang = getCurrentLanguage();
        const locale = currentLang === 'tr' ? 'tr-TR' : 'en-US';
        
        let weeklyHTML = `
          <div class="weekly-header">
            <button class="calendar-nav-btn" onclick="changeWeek(-1)">â† ${t('previousWeek', currentLang)}</button>
            <h3>${weekDays[0].toLocaleDateString(locale, { day: 'numeric', month: 'long' })} - ${weekDays[6].toLocaleDateString(locale, { day: 'numeric', month: 'long', year: 'numeric' })}</h3>
            <button class="calendar-nav-btn" onclick="changeWeek(1)">${t('nextWeek', currentLang)} â†’</button>
          </div>
          <div class="weekly-grid">
        `;
        
        weekDays.forEach(day => {
          const dayCourses = courses.filter(course => {
            if (!course.start_date) return false;
            const startDate = new Date(course.start_date);
            const endDate = course.end_date ? new Date(course.end_date) : startDate;
            return day >= startDate && day <= endDate;
          });
          
          const isToday = day.toDateString() === now.toDateString();
          
          weeklyHTML += `
            <div class="weekly-day ${isToday ? 'today' : ''}">
              <div class="weekly-day-header">
                <div class="weekly-day-name">${day.toLocaleDateString(locale, { weekday: 'long' })}</div>
                <div class="weekly-day-date">${day.toLocaleDateString(locale, { day: 'numeric', month: 'short' })}</div>
              </div>
              <div class="weekly-day-courses">
                ${dayCourses.length > 0 ? dayCourses.map(course => `
                  <div class="weekly-course-item" style="border-left: 4px solid ${getCourseColor(course)}">
                    <div class="weekly-course-name">${course.course_name}</div>
                    ${course.course_code ? `<div class="weekly-course-code">${course.course_code}</div>` : ''}
                  </div>
                `).join('') : `<div class="no-courses">${t('noCourses', currentLang)}</div>`}
              </div>
            </div>
          `;
        });
        
        weeklyHTML += '</div>';
        weeklyView.innerHTML = weeklyHTML;
      }
      
      // Hafta deÄŸiÅŸtir
      function changeWeek(direction) {
        currentWeekStart.setDate(currentWeekStart.getDate() + (direction * 7));
        displayWeeklyView(getFilteredCourses());
      }
      
      // Liste gÃ¶rÃ¼nÃ¼mÃ¼
      function displayListView(courses) {
        const listView = document.getElementById("listView");
        
        const sortedCourses = courses.sort((a, b) => new Date(a.start_date) - new Date(b.start_date));
        
        const currentLang = getCurrentLanguage();
        const locale = currentLang === 'tr' ? 'tr-TR' : 'en-US';
        
        if (sortedCourses.length === 0) {
          listView.innerHTML = `<p style="text-align: center; padding: 2rem; color: #666;">${t('noCourses', currentLang)}</p>`;
          return;
        }
        
        let listHTML = '<div class="list-container">';
        
        sortedCourses.forEach(course => {
          const startDate = new Date(course.start_date);
          const endDate = course.end_date ? new Date(course.end_date) : null;
          const now = new Date();
          
          const isUpcoming = startDate > now;
          const isActive = startDate <= now && (!endDate || endDate >= now);
          const isPast = endDate && endDate < now;
          
          let statusClass = 'upcoming';
          let statusText = t('upcomingStatus', currentLang);
          if (isActive) {
            statusClass = 'active';
            statusText = t('ongoingStatus', currentLang);
          } else if (isPast) {
            statusClass = 'past';
            statusText = t('completedStatus', currentLang);
          }
          
          const duration = endDate ? Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24)) : null;
          
          listHTML += `
            <div class="list-item ${statusClass}">
              <div class="list-item-header">
                <h4>${course.course_name || (currentLang === 'tr' ? 'Ders' : 'Course')}</h4>
                <span class="list-status status-${statusClass}">${statusText}</span>
              </div>
              <div class="list-item-content">
                <div class="list-item-info">
                  ${course.course_code ? `<p><strong>${t('courseCodeLabel', currentLang)}</strong> ${course.course_code}</p>` : ''}
                  ${course.university_name ? `<p><strong>${t('universityLabel', currentLang)}</strong> ${course.university_name}</p>` : ''}
                  <p><strong>${t('startLabel', currentLang)}</strong> ${startDate.toLocaleDateString(locale, { day: 'numeric', month: 'long', year: 'numeric' })}</p>
                  ${endDate ? `<p><strong>${t('endLabel', currentLang)}</strong> ${endDate.toLocaleDateString(locale, { day: 'numeric', month: 'long', year: 'numeric' })}</p>` : ''}
                  ${duration ? `<p><strong>${t('duration', currentLang)}</strong> ${duration} ${t('days', currentLang)}</p>` : ''}
                  ${course.credits ? `<p><strong>${t('creditsLabel', currentLang)}</strong> ${course.credits}</p>` : ''}
                </div>
              </div>
            </div>
          `;
        });
        
        listHTML += '</div>';
        listView.innerHTML = listHTML;
      }
      
      // Bildirimleri yÃ¼kle
      async function loadNotifications() {
        try {
          if (!currentToken) {
            console.log('Token yok, bildirimler yÃ¼klenemiyor');
            return;
          }
          
          console.log('Bildirimler yÃ¼kleniyor...');
          const response = await fetch(`${API_URL}/notifications?unreadOnly=true`, {
            headers: {
              'Authorization': `Bearer ${currentToken}`
            }
          });
          
          if (!response.ok) {
            console.error('Bildirimler yÃ¼kleme hatasÄ±:', response.status, response.statusText);
            const errorData = await response.json().catch(() => ({}));
            console.error('Hata detayÄ±:', errorData);
            return;
          }
          
          const data = await response.json();
          console.log('Bildirimler verisi:', data);
          
          if (data.success) {
            const unreadCount = data.unreadCount || 0;
            console.log('OkunmamÄ±ÅŸ bildirim sayÄ±sÄ±:', unreadCount);
            updateNotificationBadge(unreadCount);
            displayNotifications(data.data || []);
          } else {
            console.error('Bildirimler yÃ¼klenemedi:', data.message);
            updateNotificationBadge(0);
            displayNotifications([]);
          }
        } catch (error) {
          console.error("Bildirimler yÃ¼klenirken hata:", error);
          updateNotificationBadge(0);
          displayNotifications([]);
        }
      }
      
      // TÃ¼m bildirimleri yÃ¼kle (dropdown iÃ§in)
      async function loadAllNotifications() {
        try {
          const response = await fetch(`${API_URL}/notifications`, {
            headers: {
              'Authorization': `Bearer ${currentToken}`
            }
          });
          
          const data = await response.json();
          
          if (data.success) {
            updateNotificationBadge(data.unreadCount || 0);
            displayNotifications(data.data || []);
          }
        } catch (error) {
          console.error("Bildirimler yÃ¼klenirken hata:", error);
        }
      }
      
      // Bildirim rozetini gÃ¼ncelle
      function updateNotificationBadge(count) {
        const badge = document.getElementById("notificationBadge");
        if (count > 0) {
          badge.textContent = count > 99 ? '99+' : count;
          badge.style.display = 'block';
        } else {
          badge.style.display = 'none';
        }
      }
      
      // Bildirimleri gÃ¶ster
      function displayNotifications(notifications) {
        const list = document.getElementById("notificationList");
        
        if (notifications.length === 0) {
          list.innerHTML = '<div class="no-notifications">HenÃ¼z bildirim yok</div>';
          document.getElementById("markAllReadBtn").style.display = 'none';
          return;
        }
        
        document.getElementById("markAllReadBtn").style.display = 'block';
        
        list.innerHTML = notifications.map(notif => {
          const formatDate = (dateStr) => {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            const now = new Date();
            const diff = now - date;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);
            
            if (minutes < 1) return 'Az Ã¶nce';
            if (minutes < 60) return `${minutes} dakika Ã¶nce`;
            if (hours < 24) return `${hours} saat Ã¶nce`;
            if (days < 7) return `${days} gÃ¼n Ã¶nce`;
            return date.toLocaleDateString('tr-TR', { day: 'numeric', month: 'long' });
          };
          
          const iconMap = {
            'application_approved': 'âœ…',
            'application_rejected': 'âŒ',
            'new_application': 'ğŸ“'
          };
          
          return `
            <div class="notification-item ${notif.is_read ? 'read' : 'unread'}" onclick="markNotificationAsRead(${notif.id})">
              <div class="notification-icon-item">${iconMap[notif.type] || 'ğŸ””'}</div>
              <div class="notification-content">
                <div class="notification-title">${notif.title}</div>
                <div class="notification-message">${notif.message}</div>
                <div class="notification-time">${formatDate(notif.created_at)}</div>
              </div>
              ${!notif.is_read ? '<div class="notification-dot"></div>' : ''}
            </div>
          `;
        }).join('');
      }
      
      // Bildirimi okundu olarak iÅŸaretle
      async function markNotificationAsRead(notificationId) {
        try {
          const response = await fetch(`${API_URL}/notifications/${notificationId}/read`, {
            method: 'PUT',
            headers: {
              'Authorization': `Bearer ${currentToken}`
            }
          });
          
          if (response.ok) {
            loadNotifications();
          }
        } catch (error) {
          console.error("Bildirim gÃ¼ncelleme hatasÄ±:", error);
        }
      }
      
      // TÃ¼m bildirimleri okundu olarak iÅŸaretle
      async function markAllNotificationsAsRead() {
        try {
          const response = await fetch(`${API_URL}/notifications/read-all`, {
            method: 'PUT',
            headers: {
              'Authorization': `Bearer ${currentToken}`
            }
          });
          
          if (response.ok) {
            loadNotifications();
          }
        } catch (error) {
          console.error("Bildirimler gÃ¼ncelleme hatasÄ±:", error);
        }
      }
      
      // Bildirim polling (her 30 saniyede bir kontrol et)
      let notificationInterval;
      function startNotificationPolling() {
        if (notificationInterval) {
          clearInterval(notificationInterval);
        }
        notificationInterval = setInterval(() => {
          loadNotifications();
        }, 30000); // 30 saniye
      }
      
      function stopNotificationPolling() {
        if (notificationInterval) {
          clearInterval(notificationInterval);
        }
      }

      // Ãœniversiteleri yÃ¼kle
      async function loadUniversities() {
        try {
          const response = await fetch(`${API_URL}/universities`);
          const data = await response.json();
          
          if (data.success && data.universities) {
            const select = document.getElementById("university");
            select.innerHTML = '<option value="">Ãœniversite SeÃ§in</option>';
            
            data.universities.forEach(uni => {
              const option = document.createElement("option");
              option.value = uni.id;
              option.textContent = uni.name;
              select.appendChild(option);
            });
          }
        } catch (error) {
          console.error("Ãœniversiteler yÃ¼klenirken hata:", error);
        }
      }

      // FakÃ¼lteleri yÃ¼kle
      async function loadFaculties() {
        try {
          const response = await fetch(`${API_URL}/faculties`);
          const data = await response.json();
          
          if (data.success && data.faculties) {
            const select = document.getElementById("faculty");
            select.innerHTML = '<option value="">FakÃ¼lte SeÃ§in</option>';
            
            data.faculties.forEach(faculty => {
              const option = document.createElement("option");
              option.value = faculty.id;
              option.textContent = faculty.name;
              select.appendChild(option);
            });
          }
        } catch (error) {
          console.error("FakÃ¼lteler yÃ¼klenirken hata:", error);
        }
      }

      // Favori dersleri yÃ¼kle
      async function loadFavoriteCourses() {
        try {
          const response = await fetch(`${API_URL}/favorites`, {
            headers: {
              'Authorization': `Bearer ${currentToken}`
            }
          });
          const data = await response.json();
          
          if (data.success && data.favorites && data.favorites.length > 0) {
            document.getElementById("favoriteCourses").style.display = "block";
            displayFavoriteCourses(data.favorites);
          }
        } catch (error) {
          console.error("Favori dersler yÃ¼klenirken hata:", error);
        }
      }

      // Favori dersleri gÃ¶ster
      function displayFavoriteCourses(favorites) {
        const grid = document.getElementById("favoriteCoursesGrid");
        grid.innerHTML = "";
        const currentLang = getCurrentLanguage();
        const locale = currentLang === 'tr' ? 'tr-TR' : 'en-US';

        favorites.forEach(favorite => {
          const card = document.createElement("div");
          card.className = "favorite-course-card";
          const removeTitle = currentLang === 'tr' ? 'Favorilerden KaldÄ±r' : 'Remove from Favorites';
          const notSpecified = currentLang === 'tr' ? 'BelirtilmemiÅŸ' : 'Not specified';
          const addedText = currentLang === 'tr' ? 'Eklenme:' : 'Added:';
          
          card.innerHTML = `
            <div class="course-header">
              <h3>${favorite.course_name}</h3>
              <button class="remove-favorite-btn" onclick="removeFavorite(${favorite.id})" title="${removeTitle}">
                âŒ
              </button>
            </div>
            <div class="course-info">
              <p><strong>${t('courseCodeLabel', currentLang)}</strong> ${favorite.course_code || '-'}</p>
              <p><strong>${t('category', currentLang)}</strong> ${favorite.category || '-'}</p>
              <p><strong>${t('academicianLabel', currentLang)}</strong> ${favorite.academician_name || notSpecified}</p>
            </div>
            <div class="course-meta">
              <span class="added-date">ğŸ“… ${addedText} ${new Date(favorite.favorited_at || favorite.created_at).toLocaleDateString(locale)}</span>
            </div>
          `;
          grid.appendChild(card);
        });
      }

      // Favoriden kaldÄ±r
      async function removeFavorite(courseId) {
        const currentLang = getCurrentLanguage();
        if (!confirm(t('removeFavoriteConfirm', currentLang))) {
          return;
        }

        try {
          const response = await fetch(`${API_URL}/favorites/${courseId}`, {
            method: 'DELETE',
            headers: {
              'Authorization': `Bearer ${currentToken}`
            }
          });

          const data = await response.json();

          if (data.success) {
            alert(t('favoriteRemoved', currentLang));
            loadFavoriteCourses();
          } else {
            alert(data.message || (currentLang === 'tr' ? 'Bir hata oluÅŸtu' : 'An error occurred'));
          }
        } catch (error) {
          console.error("Favori kaldÄ±rma hatasÄ±:", error);
          const errorMsg = currentLang === 'tr' ? 'Bir hata oluÅŸtu' : 'An error occurred';
          alert(errorMsg);
        }
      }


      // Bildirim dropdown toggle
      document
        .getElementById("notificationToggle")
        .addEventListener("click", function (e) {
          e.stopPropagation();
          const dropdown = document.getElementById("notificationDropdown");
          const profileDropdown = document.getElementById("profileDropdown");
          profileDropdown.classList.remove("active");
          dropdown.classList.toggle("active");
          if (dropdown.classList.contains("active")) {
            loadAllNotifications();
          }
        });
      
      // Profil dropdown toggle
      document
        .getElementById("profileToggle")
        .addEventListener("click", function (e) {
          e.stopPropagation();
          const dropdown = document.getElementById("profileDropdown");
          const notificationDropdown = document.getElementById("notificationDropdown");
          notificationDropdown.classList.remove("active");
          dropdown.classList.toggle("active");
        });

      // Dropdown dÄ±ÅŸÄ±na tÄ±klanÄ±nca kapat
      document.addEventListener("click", function (e) {
        const dropdown = document.getElementById("profileDropdown");
        const notificationDropdown = document.getElementById("notificationDropdown");
        const profileSection = document.querySelector(".profile-section");
        const notificationSection = document.querySelector(".notification-section");
        
        if (!profileSection.contains(e.target)) {
          dropdown.classList.remove("active");
        }
        if (!notificationSection.contains(e.target)) {
          notificationDropdown.classList.remove("active");
        }
      });
      
      // TÃ¼mÃ¼nÃ¼ okundu iÅŸaretle butonu
      document.getElementById("markAllReadBtn").addEventListener("click", function(e) {
        e.stopPropagation();
        markAllNotificationsAsRead();
      });

      // Ã‡Ä±kÄ±ÅŸ yap
      document
        .getElementById("logoutBtn")
        .addEventListener("click", function () {
          localStorage.removeItem("token");
          localStorage.removeItem("user");
          // Ana giriÅŸ sayfasÄ±na yÃ¶nlendir
          const basePath = window.location.pathname.split('/campusumer-anasayfa')[0];
          window.location.href = basePath + '/website-giri%C5%9F-sayfas%C4%B1/website-giri%C5%9F-sayfas%C4%B1.html';
        });

      // Profil DÃ¼zenleme Modal Ä°ÅŸlemleri
      const modal = document.getElementById("editProfileModal");
      const editProfileBtn = document.getElementById("editProfileBtn");
      const closeModalBtn = document.getElementById("closeModal");
      const cancelEditBtn = document.getElementById("cancelEdit");
      const editProfileForm = document.getElementById("editProfileForm");

      // Modal aÃ§ma
      editProfileBtn.addEventListener("click", function (e) {
        e.stopPropagation();
        const user = JSON.parse(localStorage.getItem("user"));
        if (user) {
          // Form alanlarÄ±nÄ± doldur
          document.getElementById("editFirstName").value = user.firstName || "";
          document.getElementById("editLastName").value = user.lastName || "";
          document.getElementById("editEmail").value = user.email || "";
          
          // KullanÄ±cÄ± tipine gÃ¶re identifier alanÄ±nÄ± ayarla
          const identifierInput = document.getElementById("editIdentifier");
          const identifierLabel = document.getElementById("identifierLabel");
          const identifierHelp = document.getElementById("identifierHelp");
          
          const currentLang = getCurrentLanguage();
          if (user.userType === "academician") {
            identifierLabel.textContent = t('usernameLabel', currentLang);
            identifierInput.value = user.username || "";
            identifierInput.removeAttribute("readonly");
            identifierHelp.textContent = t('canChangeUsername', currentLang);
            identifierHelp.style.color = "#667eea";
          } else if (user.userType === "student") {
            identifierLabel.textContent = t('studentNumberLabel', currentLang);
            identifierInput.value = user.studentNumber || "";
            identifierInput.setAttribute("readonly", "readonly");
            identifierHelp.textContent = t('cannotChangeField', currentLang);
            identifierHelp.style.color = "#666";
          } else {
            identifierLabel.textContent = t('usernameLabel', currentLang);
            identifierInput.value = user.username || "";
            identifierInput.setAttribute("readonly", "readonly");
            identifierHelp.textContent = t('cannotChangeField', currentLang);
            identifierHelp.style.color = "#666";
          }
          
          // Åifre alanlarÄ±nÄ± temizle
          document.getElementById("editCurrentPassword").value = "";
          document.getElementById("editNewPassword").value = "";
          document.getElementById("editConfirmPassword").value = "";

          // MesajlarÄ± temizle
          document.getElementById("editErrorMessage").style.display = "none";
          document.getElementById("editSuccessMessage").style.display = "none";

          modal.style.display = "flex";
          // Dropdown'u kapat
          document.getElementById("profileDropdown").classList.remove("active");
        }
      });

      // Modal kapama fonksiyonlarÄ±
      function closeModal() {
        modal.style.display = "none";
      }

      closeModalBtn.addEventListener("click", closeModal);
      cancelEditBtn.addEventListener("click", closeModal);

      // Modal dÄ±ÅŸÄ±na tÄ±klandÄ±ÄŸÄ±nda kapat
      modal.addEventListener("click", function (e) {
        if (e.target === modal) {
          closeModal();
        }
      });

      // Profil gÃ¼ncelleme formu
      editProfileForm.addEventListener("submit", async function (e) {
        e.preventDefault();

        const errorDiv = document.getElementById("editErrorMessage");
        const successDiv = document.getElementById("editSuccessMessage");
        errorDiv.style.display = "none";
        successDiv.style.display = "none";

        const user = JSON.parse(localStorage.getItem("user"));
        const token = localStorage.getItem("token");

        const currentLang = getCurrentLanguage();
        if (!user || !token) {
          errorDiv.textContent = t('sessionNotFound', currentLang);
          errorDiv.style.display = "block";
          return;
        }

        // Form verilerini al
        const firstName = document.getElementById("editFirstName").value.trim();
        const lastName = document.getElementById("editLastName").value.trim();
        const email = document.getElementById("editEmail").value.trim();
        const identifier = document.getElementById("editIdentifier").value.trim();
        const currentPassword = document.getElementById("editCurrentPassword").value;
        const newPassword = document.getElementById("editNewPassword").value;
        const confirmPassword = document.getElementById("editConfirmPassword").value;

        // Åifre doÄŸrulamasÄ±
        if (newPassword || confirmPassword) {
          if (!currentPassword) {
            errorDiv.textContent = t('currentPasswordRequired', currentLang);
            errorDiv.style.display = "block";
            return;
          }
          if (newPassword !== confirmPassword) {
            errorDiv.textContent = t('passwordsNotMatch', currentLang);
            errorDiv.style.display = "block";
            return;
          }
          if (newPassword.length < 6) {
            errorDiv.textContent = t('passwordMinLength', currentLang);
            errorDiv.style.display = "block";
            return;
          }
        }

        // Akademisyen iÃ§in kullanÄ±cÄ± adÄ± kontrolÃ¼
        if (user.userType === "academician" && identifier) {
          if (identifier.length < 3) {
            errorDiv.textContent = t('usernameMinLength', currentLang);
            errorDiv.style.display = "block";
            return;
          }
          if (!/^[a-zA-Z0-9_]+$/.test(identifier)) {
            errorDiv.textContent = t('usernameInvalidChars', currentLang);
            errorDiv.style.display = "block";
            return;
          }
        }

        // API isteÄŸi iÃ§in veri hazÄ±rla
        const updateData = {
          firstName,
          lastName,
          email,
        };

        // Akademisyen iÃ§in kullanÄ±cÄ± adÄ±nÄ± ekle
        if (user.userType === "academician" && identifier) {
          updateData.username = identifier;
        }

        if (newPassword) {
          updateData.currentPassword = currentPassword;
          updateData.newPassword = newPassword;
        }

        try {
          const API_URL = `${window.location.origin}/api`;
          const endpoint = `${API_URL}/auth/profile/update`;

          const response = await fetch(endpoint, {
            method: "PUT",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${token}`,
            },
            body: JSON.stringify(updateData),
          });

          const data = await response.json();

          const currentLang = getCurrentLanguage();
          if (response.ok && data.success) {
            successDiv.textContent = t('profileUpdated', currentLang);
            successDiv.style.display = "block";

            // LocalStorage'Ä± gÃ¼ncelle - Backend'den dÃ¶nen gÃ¼ncel kullanÄ±cÄ± bilgilerini kullan
            const updatedUser = data.user || { ...user, ...updateData };
            delete updatedUser.currentPassword;
            delete updatedUser.newPassword;
            localStorage.setItem("user", JSON.stringify(updatedUser));

            // Profil bilgilerini yeniden yÃ¼kle
            setTimeout(() => {
              loadUserProfile();
              closeModal();
            }, 1500);
          } else {
            errorDiv.textContent = data.message || t('profileUpdateError', currentLang);
            errorDiv.style.display = "block";
          }
        } catch (error) {
          console.error("Profil gÃ¼ncelleme hatasÄ±:", error);
          const currentLang = getCurrentLanguage();
          errorDiv.textContent = t('serverConnectionError', currentLang);
          errorDiv.style.display = "block";
        }
      });

      // Dersten Ã§Ä±kÄ±ÅŸ yap (Ä°ptal Et)
      async function withdrawFromCourse(courseId) {
        const currentLang = getCurrentLanguage();
        const confirmMessage = `âš ï¸ ${t('withdrawCourseConfirm', currentLang)}\n\n${t('withdrawCourseWarning', currentLang)}`;
        if (!confirm(confirmMessage)) {
          return;
        }
        
        try {
          const response = await fetch(`${API_URL}/student-courses/${courseId}/withdraw`, {
            method: 'DELETE',
            headers: {
              'Authorization': `Bearer ${currentToken}`
            }
          });
          
          const data = await response.json();
          
          if (response.ok && data.success) {
            alert('âœ… ' + t('courseWithdrawn', currentLang));
            // KayÄ±tlÄ± dersleri yenile
            loadEnrolledCourses();
            // Ders planlamasÄ±nÄ± da yenile
            loadCoursePlanning();
          } else {
            alert('âŒ Hata: ' + (data.message || (currentLang === 'tr' ? 'Dersten Ã§Ä±kÄ±ÅŸ yapÄ±lamadÄ±' : 'Could not withdraw from course')));
          }
        } catch (error) {
          console.error('Dersten Ã§Ä±kÄ±ÅŸ hatasÄ±:', error);
          const errorMsg = currentLang === 'tr' ? 'Sunucuya baÄŸlanÄ±lamadÄ±: ' : 'Could not connect to server: ';
          alert('âŒ ' + errorMsg + error.message);
        }
      }

      // Akademisyen: Dashboard yÃ¼kle
      async function loadAcademicianDashboard() {
        try {
          const response = await fetch(`${API_URL}/summer-offerings/my/offerings`, {
            headers: {
              'Authorization': `Bearer ${currentToken}`
            }
          });
          
          const data = await response.json();
          const courses = data.data || [];
          
          // Ä°statistikleri hesapla
          let totalCourses = courses.length;
          let totalStudents = 0;
          let pendingApplications = 0;
          let activeCourses = 0;
          
          courses.forEach(course => {
            totalStudents += parseInt(course.current_registrations || 0);
            if (course.is_active) activeCourses++;
          });
          
          // Bekleyen baÅŸvurularÄ± say
          for (const course of courses) {
            try {
              const appResponse = await fetch(`${API_URL}/summer-registrations/offering/${course.id}`, {
                headers: {
                  'Authorization': `Bearer ${currentToken}`
                }
              });
              const appData = await appResponse.json();
              if (appData.success && appData.data) {
                pendingApplications += appData.data.filter(reg => reg.status === 'pending').length;
              }
            } catch (error) {
              console.error('BaÅŸvuru sayÄ±sÄ± alÄ±nÄ±rken hata:', error);
            }
          }
          
          // Ä°statistikleri gÃ¶ster
          displayAcademicianStats({
            totalCourses,
            totalStudents,
            pendingApplications,
            activeCourses
          });
        } catch (error) {
          console.error("Akademisyen dashboard yÃ¼klenirken hata:", error);
          displayAcademicianStats({
            totalCourses: 0,
            totalStudents: 0,
            pendingApplications: 0,
            activeCourses: 0
          });
        }
      }
      
      // Akademisyen istatistiklerini gÃ¶ster
      function displayAcademicianStats(stats) {
        const statsGrid = document.getElementById("academicianStatsGrid");
        const currentLang = getCurrentLanguage();
        statsGrid.innerHTML = `
          <div class="stat-card">
            <div class="stat-icon">ğŸ“š</div>
            <div class="stat-value">${stats.totalCourses}</div>
            <div class="stat-label">${t('totalCourseLabel', currentLang)}</div>
          </div>
          <div class="stat-card stat-active">
            <div class="stat-icon">âœ…</div>
            <div class="stat-value">${stats.activeCourses}</div>
            <div class="stat-label">${t('activeCourseLabel', currentLang)}</div>
          </div>
          <div class="stat-card stat-upcoming">
            <div class="stat-icon">ğŸ‘¥</div>
            <div class="stat-value">${stats.totalStudents}</div>
            <div class="stat-label">${t('totalStudentLabel', currentLang)}</div>
          </div>
          <div class="stat-card stat-past">
            <div class="stat-icon">â³</div>
            <div class="stat-value">${stats.pendingApplications}</div>
            <div class="stat-label">${t('pendingApplicationLabel', currentLang)}</div>
          </div>
        `;
      }
      
      // Akademisyen: Kendi derslerini yÃ¼kle
      async function loadMyCourses() {
        try {
          const response = await fetch(`${API_URL}/summer-offerings/my/offerings`, {
            headers: {
              'Authorization': `Bearer ${currentToken}`
            }
          });
          
          const data = await response.json();
          const courses = data.data || [];
          
          if (courses.length > 0) {
            displayMyCourses(courses);
          } else {
            const currentLang = getCurrentLanguage();
            document.getElementById("myCoursesGrid").innerHTML = 
              `<p style="text-align: center; padding: 2rem; color: #666; grid-column: 1/-1;">${t('noCoursesAdded', currentLang)} <a href="../Dersler/dersler.html" style="color: #667eea;">${t('addNewCourse', currentLang)}</a></p>`;
          }
        } catch (error) {
          console.error("Dersler yÃ¼klenirken hata:", error);
          const currentLang = getCurrentLanguage();
          document.getElementById("myCoursesGrid").innerHTML = 
            `<p style="text-align: center; padding: 2rem; color: #dc3545; grid-column: 1/-1;">${t('errorLoadingMyCourses', currentLang)}</p>`;
        }
      }
      
      // Akademisyen derslerini gÃ¶ster
      function displayMyCourses(courses) {
        const grid = document.getElementById("myCoursesGrid");
        grid.innerHTML = "";
        const currentLang = getCurrentLanguage();
        const locale = currentLang === 'tr' ? 'tr-TR' : 'en-US';
        
        courses.forEach(course => {
          const formatDate = (dateStr) => {
            if (!dateStr) return currentLang === 'tr' ? 'BelirtilmemiÅŸ' : 'Not specified';
            const date = new Date(dateStr);
            return date.toLocaleDateString(locale, { 
              day: 'numeric', 
              month: 'long', 
              year: 'numeric' 
            });
          };
          
          const card = document.createElement("div");
          card.className = "enrolled-course-card";
          const statusText = course.is_active 
            ? (currentLang === 'tr' ? 'âœ… Aktif' : 'âœ… Active')
            : (currentLang === 'tr' ? 'âŒ Pasif' : 'âŒ Inactive');
          
          card.innerHTML = `
            <div class="course-header">
              <h3>${course.course_name || (currentLang === 'tr' ? 'Ders AdÄ±' : 'Course Name')}</h3>
              ${course.course_code ? `<span class="course-code">${course.course_code}</span>` : ''}
            </div>
            <div class="course-info">
              ${course.university_name ? `<p><strong>ğŸ›ï¸ ${t('universityLabel', currentLang)}</strong> ${course.university_name}</p>` : ''}
              ${course.start_date ? `<p><strong>ğŸ¯ ${t('startLabel', currentLang)}</strong> ${formatDate(course.start_date)}</p>` : ''}
              ${course.end_date ? `<p><strong>ğŸ ${t('endLabel', currentLang)}</strong> ${formatDate(course.end_date)}</p>` : ''}
              ${course.credits ? `<p><strong>ğŸ“š ${t('creditsLabel', currentLang)}</strong> ${course.credits}</p>` : ''}
              <p><strong>ğŸ‘¥ ${t('registeredStudents', currentLang)}</strong> ${course.current_registrations || 0} / ${course.quota || 0}</p>
              <p><strong>ğŸ“Š ${t('statusLabel', currentLang)}</strong> <span class="status-badge status-${course.is_active ? 'active' : 'past'}">${statusText}</span></p>
            </div>
            <div class="course-actions">
              <a href="../Dersler/dersler.html" class="btn-course-link" style="display: block; text-align: center; margin-bottom: 10px;">
                ğŸ“‹ ${t('manageCourse', currentLang)}
              </a>
              <button onclick="viewCourseApplications(${course.id})" class="btn-withdraw-course" style="background: #ffc107; color: #212529;">
                ğŸ“ ${t('viewApplications', currentLang)}
              </button>
            </div>
          `;
          grid.appendChild(card);
        });
      }
      
      // Bekleyen baÅŸvurularÄ± yÃ¼kle ve modal gÃ¶ster
      async function showPendingApplicationsModal() {
        const modal = document.getElementById('pendingApplicationsModal');
        const modalBody = document.getElementById('pendingApplicationsModalBody');
        
        modal.style.display = 'flex';
        modalBody.innerHTML = '<div class="loading-message" style="text-align: center; padding: 40px;">YÃ¼kleniyor...</div>';
        
        try {
          const response = await fetch(`${API_URL}/summer-offerings/my/offerings`, {
            headers: {
              'Authorization': `Bearer ${currentToken}`
            }
          });
          
          const data = await response.json();
          const courses = data.data || [];
          
          let allPendingApplications = [];
          
          for (const course of courses) {
            try {
              const appResponse = await fetch(`${API_URL}/summer-registrations/offering/${course.id}`, {
                headers: {
                  'Authorization': `Bearer ${currentToken}`
                }
              });
              const appData = await appResponse.json();
              if (appData.success && appData.data) {
                const pending = appData.data.filter(reg => reg.status === 'pending');
                pending.forEach(reg => {
                  allPendingApplications.push({
                    ...reg,
                    course_name: course.course_name,
                    course_code: course.course_code,
                    course_id: course.id
                  });
                });
              }
            } catch (error) {
              console.error('BaÅŸvuru yÃ¼klenirken hata:', error);
            }
          }
          
          const currentLang = getCurrentLanguage();
          if (allPendingApplications.length > 0) {
            displayPendingApplications(allPendingApplications);
          } else {
            modalBody.innerHTML = `<div style="text-align: center; padding: 40px; color: #666;"><p style="font-size: 1.2rem; margin-bottom: 1rem;">âœ… ${t('noPendingApplications', currentLang)}</p><p>${t('allApplicationsProcessed', currentLang)}</p></div>`;
          }
        } catch (error) {
          console.error("Bekleyen baÅŸvurular yÃ¼klenirken hata:", error);
          const currentLang = getCurrentLanguage();
          modalBody.innerHTML = `<div style="text-align: center; padding: 40px; color: #dc3545;">${t('errorLoadingCourses', currentLang)}</div>`;
        }
      }
      
      // Bekleyen baÅŸvurularÄ± gÃ¶ster
      function displayPendingApplications(applications) {
        const modalBody = document.getElementById('pendingApplicationsModalBody');
        const currentLang = getCurrentLanguage();
        const locale = currentLang === 'tr' ? 'tr-TR' : 'en-US';
        
        const formatDate = (dateStr) => {
          if (!dateStr) return currentLang === 'tr' ? 'BelirtilmemiÅŸ' : 'Not specified';
          const date = new Date(dateStr);
          return date.toLocaleDateString(locale, { 
            day: 'numeric', 
            month: 'long', 
            year: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
          });
        };
        
        let html = `
          <div style="margin-bottom: 20px;">
            <h3 style="color: #212529; margin-bottom: 10px;">${t('pendingApplicationsTitle', currentLang)} (${applications.length})</h3>
            <p style="color: #666; font-size: 0.9rem;">${t('pendingApplicationsSubtitle', currentLang)}</p>
          </div>
          <div style="max-height: 500px; overflow-y: auto;">
        `;
        
        applications.forEach((app, index) => {
          const studentName = `${app.first_name || ''} ${app.last_name || ''}`.trim() || (currentLang === 'tr' ? 'Ã–ÄŸrenci' : 'Student');
          const studentEmail = app.email || t('studentEmail', currentLang);
          
          html += `
            <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; margin-bottom: 15px; border-radius: 8px;">
              <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                <div>
                  <h4 style="margin: 0 0 5px 0; color: #212529;">${studentName}</h4>
                  <p style="margin: 5px 0; color: #666; font-size: 0.9em;">ğŸ“§ ${studentEmail}</p>
                  ${app.student_number ? `<p style="margin: 5px 0; color: #666; font-size: 0.9em;">ğŸ“ ${t('studentNumberShort', currentLang)} ${app.student_number}</p>` : ''}
                </div>
                <span style="background: #ffc107; color: #212529; padding: 4px 12px; border-radius: 12px; font-size: 0.85em; font-weight: bold;">â³ ${t('waitingStatus', currentLang)}</span>
              </div>
              <div style="background: white; padding: 10px; border-radius: 8px; margin-bottom: 10px;">
                <p style="margin: 0 0 5px 0; font-weight: 600; color: #212529;">ğŸ“š ${t('courseLabel', currentLang)} ${app.course_name || app.course_code || (currentLang === 'tr' ? 'Ders' : 'Course')}</p>
                <p style="margin: 5px 0; color: #666; font-size: 0.9em;">ğŸ“… ${t('applicationDate', currentLang)} ${formatDate(app.application_date)}</p>
              </div>
              ${app.application_note ? `
                <div style="background: white; padding: 10px; border-radius: 8px; margin-bottom: 10px;">
                  <strong>ğŸ“ ${t('applicationNoteLabel', currentLang)}</strong>
                  <p style="margin: 5px 0 0 0; color: #495057;">${app.application_note}</p>
                </div>
              ` : ''}
              <div style="display: flex; gap: 10px; margin-top: 10px;">
                <button onclick="approveApplication(${app.id}, ${app.course_id})" style="background: #28a745; color: white; border: none; padding: 8px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; flex: 1;">
                  âœ… ${t('approve', currentLang)}
                </button>
                <button onclick="rejectApplication(${app.id}, ${app.course_id})" style="background: #dc3545; color: white; border: none; padding: 8px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; flex: 1;">
                  âŒ ${t('reject', currentLang)}
                </button>
                <a href="../Dersler/dersler.html" style="background: #667eea; color: white; border: none; padding: 8px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; text-decoration: none; text-align: center; flex: 1;">
                  ğŸ“‹ ${t('allApplications', currentLang)}
                </a>
              </div>
            </div>
          `;
        });
        
        html += '</div>';
        modalBody.innerHTML = html;
      }
      
      // BaÅŸvuruyu onayla
      async function approveApplication(registrationId, courseId) {
        const currentLang = getCurrentLanguage();
        if (!confirm(t('confirmApplication', currentLang))) {
          return;
        }
        
        try {
          const response = await fetch(`${API_URL}/summer-registrations/${registrationId}/status`, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${currentToken}`
            },
            body: JSON.stringify({
              status: 'approved'
            })
          });
          
          const data = await response.json();
          
          if (response.ok && data.success) {
            alert('âœ… ' + t('applicationApproved', currentLang));
            // Modal'Ä± yenile
            showPendingApplicationsModal();
            // Ä°statistikleri yenile
            loadAcademicianDashboard();
            // Dersleri yenile
            loadMyCourses();
          } else {
            const errorMsg = currentLang === 'tr' ? 'BaÅŸvuru onaylanamadÄ±' : 'Application could not be approved';
            alert('âŒ Hata: ' + (data.message || errorMsg));
          }
        } catch (error) {
          console.error('BaÅŸvuru onaylama hatasÄ±:', error);
          const errorMsg = currentLang === 'tr' ? 'Sunucuya baÄŸlanÄ±lamadÄ±: ' : 'Could not connect to server: ';
          alert('âŒ ' + errorMsg + error.message);
        }
      }
      
      // BaÅŸvuruyu reddet
      async function rejectApplication(registrationId, courseId) {
        const currentLang = getCurrentLanguage();
        const rejectionReason = prompt(t('rejectionReason', currentLang));
        if (rejectionReason === null) {
          return; // KullanÄ±cÄ± iptal etti
        }
        
        try {
          const response = await fetch(`${API_URL}/summer-registrations/${registrationId}/status`, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${currentToken}`
            },
            body: JSON.stringify({
              status: 'rejected',
              rejectionReason: rejectionReason || undefined
            })
          });
          
          const data = await response.json();
          
          if (response.ok && data.success) {
            alert('âœ… ' + t('applicationRejected', currentLang));
            // Modal'Ä± yenile
            showPendingApplicationsModal();
            // Ä°statistikleri yenile
            loadAcademicianDashboard();
            // Dersleri yenile
            loadMyCourses();
          } else {
            const errorMsg = currentLang === 'tr' ? 'BaÅŸvuru reddedilemedi' : 'Application could not be rejected';
            alert('âŒ Hata: ' + (data.message || errorMsg));
          }
        } catch (error) {
          console.error('BaÅŸvuru reddetme hatasÄ±:', error);
          const errorMsg = currentLang === 'tr' ? 'Sunucuya baÄŸlanÄ±lamadÄ±: ' : 'Could not connect to server: ';
          alert('âŒ ' + errorMsg + error.message);
        }
      }
      
      // Derslerime scroll et
      function scrollToMyCourses() {
        const myCoursesSection = document.getElementById("myCoursesSection");
        if (myCoursesSection) {
          // Dersleri yenile
          loadMyCourses();
          // Scroll et
          setTimeout(() => {
            myCoursesSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }, 300);
        }
      }
      
      // Ders baÅŸvurularÄ±nÄ± gÃ¶rÃ¼ntÃ¼le
      function viewCourseApplications(courseId) {
        window.location.href = `../Dersler/dersler.html?courseId=${courseId}`;
      }
      
      // Bekleyen baÅŸvurular modalÄ±nÄ± kapat
      function closePendingApplicationsModal() {
        document.getElementById('pendingApplicationsModal').style.display = 'none';
      }
      
      // Modal dÄ±ÅŸÄ±na tÄ±klandÄ±ÄŸÄ±nda kapat
      document.addEventListener('click', function(e) {
        const pendingModal = document.getElementById('pendingApplicationsModal');
        if (e.target === pendingModal) {
          closePendingApplicationsModal();
        }
      });

      // Hero istatistiklerini yÃ¼kle
      async function loadHeroStatistics() {
        try {
          const response = await fetch(`${API_URL}/universities/statistics`);
          const data = await response.json();
          
          if (data.success && data.statistics) {
            const stats = data.statistics;
            
            // Ãœniversite sayÄ±sÄ±
            const universityCount = stats.universities || 0;
            const universityElement = document.getElementById('heroUniversityCount');
            if (universityElement) {
              universityElement.textContent = universityCount > 0 ? `${universityCount}` : '0';
            }
            
            // Ders sayÄ±sÄ±
            const courseCount = stats.courses || 0;
            const courseElement = document.getElementById('heroCourseCount');
            if (courseElement) {
              courseElement.textContent = courseCount > 0 ? `${courseCount}` : '0';
            }
            
            // Ã–ÄŸrenci sayÄ±sÄ±
            const studentCount = stats.students || 0;
            const studentElement = document.getElementById('heroStudentCount');
            if (studentElement) {
              studentElement.textContent = studentCount > 0 ? `${studentCount}` : '0';
            }
            
            // Alt baÅŸlÄ±ÄŸÄ± gÃ¼ncelle
            const subtitleElement = document.getElementById('heroSubtitle');
            if (subtitleElement && universityCount > 0) {
              const currentLang = getCurrentLanguage();
              subtitleElement.textContent = t('heroSubtitle', currentLang).replace('200+', `${universityCount}+`);
            }
          } else {
            console.error('Ä°statistikler yÃ¼klenemedi:', data.message);
            // VarsayÄ±lan deÄŸerleri gÃ¶ster
            setDefaultHeroStats();
          }
        } catch (error) {
          console.error('Ä°statistikler yÃ¼klenirken hata:', error);
          // Hata durumunda varsayÄ±lan deÄŸerleri gÃ¶ster
          setDefaultHeroStats();
        }
      }
      
      // VarsayÄ±lan istatistikleri gÃ¶ster
      function setDefaultHeroStats() {
        const universityElement = document.getElementById('heroUniversityCount');
        const courseElement = document.getElementById('heroCourseCount');
        const studentElement = document.getElementById('heroStudentCount');
        
        if (universityElement) universityElement.textContent = '0';
        if (courseElement) courseElement.textContent = '0';
        if (studentElement) studentElement.textContent = '0';
      }

      // Override changeLanguage to also update language toggle buttons
      const originalChangeLanguage = window.changeLanguage;
      window.changeLanguage = function(lang) {
        originalChangeLanguage(lang);
        
        // Update language toggle buttons
        const englishLink = document.getElementById('englishLink');
        const turkishLink = document.getElementById('turkishLink');
        
        if (lang === 'en' && englishLink && turkishLink) {
          englishLink.style.display = 'none';
          turkishLink.style.display = 'block';
        } else if (lang === 'tr' && englishLink && turkishLink) {
          englishLink.style.display = 'block';
          turkishLink.style.display = 'none';
        }
      };

      // Dil deÄŸiÅŸtiÄŸinde dinamik iÃ§erikleri yenile
      window.addEventListener('languageChanged', function(e) {
        // Dinamik iÃ§erikleri yeniden yÃ¼kle
        if (currentUser) {
          if (currentUser.userType === "student") {
            loadEnrolledCourses();
            loadCoursePlanning();
            loadFavoriteCourses();
          }
          if (currentUser.userType === "academician") {
            loadAcademicianDashboard();
            loadMyCourses();
          }
        }
      });

      // Sayfa yÃ¼klendiÄŸinde profili ve diÄŸer verileri yÃ¼kle
      document.addEventListener("DOMContentLoaded", function() {
        // Dil ayarÄ±nÄ± uygula
        const currentLang = getCurrentLanguage();
        changeLanguage(currentLang);
        
        loadUserProfile();
        loadHeroStatistics(); // Hero istatistiklerini yÃ¼kle
      });
    </script>

    <footer>
      <div class="container">
        <div class="footer-content">
          <div class="footer-section">
            <h3>Campus Summer</h3>
            <p data-translate="footerDescription">
              TÃ¼rkiye'nin en kapsamlÄ± yaz dersleri takip platformu. Akademik
              hedeflerinize ulaÅŸmanÄ±n en kolay yolu.
            </p>
          </div>
          <div class="footer-section">
            <h3 data-translate="quickLinks">HÄ±zlÄ± BaÄŸlantÄ±lar</h3>
            <a href="anasayfa.html" data-translate="mainPage">Ana Sayfa</a>
            <a href="../Ãœniversiteler/Ãœniversitler.html" data-translate="universities">Ãœniversiteler</a>
            <a href="../Dersler/dersler.html" data-translate="courses">Dersler</a>
            <a href="../HakkÄ±mÄ±zda/HakkÄ±mÄ±zda.html" data-translate="about">HakkÄ±mÄ±zda</a>
          </div>
          <div class="footer-section">
            <h3 data-translate="support">Destek</h3>
            <a href="../Ä°letiÅŸim/iletisim.html" data-translate="contact">Ä°letiÅŸim</a>
            <a href="../Gizlilik-politikasÄ±/gizlilikpolitikasÄ±.html" data-translate="privacyPolicy"
              >Gizlilik PolitikasÄ±</a
            >
          </div>
          <div class="footer-section">
            <h3 data-translate="contactLabel">Ä°letiÅŸim</h3>
            <p>ğŸ“§ atakan.baskir@std.hku.edu.tr</p>
            <p>ğŸ“§ yusuf.tiken@std.hku.edu.tr</p>
            <p>ğŸ“ +90 506 536 1780</p>
            <p>ğŸ“ +90 533 133 2930</p>
            <p data-translate="location">ğŸ“ Gaziantep, TÃ¼rkiye</p>
          </div>
        </div>
        <div class="footer-bottom">
          <p>&copy; 2025 Campus Summer. <span data-translate="allRightsReserved">TÃ¼m haklarÄ± saklÄ±dÄ±r.</span></p>
        </div>
      </div>
    </footer>
  </body>
</html>
