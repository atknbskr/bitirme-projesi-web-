<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√úniversiteler - Campus Summer</title>
    <link rel="stylesheet" href="anasayfa.css">
    <link rel="stylesheet" href="√ºniversiteler.css">
</head>
<body>
    
    <header class="header">
        <div class="container">
            <div class="logo">
                <img src="2.3.logo.png" alt="Campus Summer Logo">
                <span>Campus Summer</span> 
            </div>
            
            <nav class="nav-menu">
                <div class="nav-item">
                    <a href="anasayfa.html" class="nav-link active">Anasayfa</a>
                </div>
                <div class="nav-item">
                    <a href="../Dersler/dersler.html" class="nav-link">Dersler</a>
                </div>
                <div class="nav-item">
                    <a href="../√úniversiteler/√úniversitler.html" class="nav-link">√úniversiteler</a>
                </div>
                <div class="nav-item">
                    <a href="../Fak√ºlteler/fak√ºlteler.html" class="nav-link">Fak√ºlteler</a>
                </div>
                <div class="nav-item">
                    <a href="../Hakkƒ±mƒ±zda/Hakkƒ±mƒ±zda.html" class="nav-link">Hakkƒ±mƒ±zda</a>
                </div>
                <div class="nav-item">
                    <a href="../ƒ∞leti≈üim/iletisim.html" class="nav-link">ƒ∞leti≈üim</a>
                </div>
            </nav>

            
    </header>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="container">
            <div class="hero-content">
                <h1>Fak√ºlteler</h1>
                <p>√úniversitelerin fak√ºltelerini ke≈üfedin ve yaz dersleri ile akademik kariyerinizi ≈üekillendirin</p>
                <div class="hero-stats">
                    <div class="stat">
                        <div class="stat-number" id="facultyCount">0</div>
                        <div class="stat-label">Fak√ºlte</div>
                    </div>
                    <div class="stat">
                        <div class="stat-number">200+</div>
                        <div class="stat-label">√úniversite</div>
                    </div>
                    <div class="stat">
                        <div class="stat-number">500+</div>
                        <div class="stat-label">Yaz Dersi</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Fak√ºlteler Section -->
    <section class="fakulteler-section">
        <div class="container">
            <div class="section-header" style="margin-bottom: 3rem;">
                <div class="search-header-row">
                    <div>
                        <h2 style="margin-bottom: 0.5rem;">Fak√ºlteler</h2>
                        <p id="universityInfoText" style="color: #666; font-size: 1rem;">√úniversiteye ait fak√ºlteler</p>
                    </div>
                    <button class="add-faculty-btn" id="addFacultyBtnTop" style="display: none;">
                        ‚ûï Fak√ºlte Ekle
                    </button>
                </div>
            </div>
            
            <div class="fakulteler-grid" id="facultiesGrid">
                <!-- Fak√ºlteler dinamik olarak y√ºklenecek -->
            </div>
        </div>
    </section>

    <!-- Fak√ºlte Ekleme Modal -->
    <div id="addFacultyModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close" onclick="closeAddFacultyModal()">&times;</span>
            <h2>Yeni Fak√ºlte Ekle</h2>
            <p id="facultyUniversityName" style="color: #666; margin-bottom: 20px;"></p>
            <form id="addFacultyForm" onsubmit="addFaculty(event)">
                <input type="hidden" id="facultyUniversityId">
                <div class="form-group">
                    <label for="facultyName">Fak√ºlte Adƒ± *</label>
                    <input type="text" id="facultyName" required>
                </div>
                <div class="form-group">
                    <label for="facultyDescription">A√ßƒ±klama</label>
                    <textarea id="facultyDescription" rows="3"></textarea>
                </div>
                <div class="form-buttons">
                    <button type="submit" class="btn-primary">Ekle</button>
                    <button type="button" class="btn-secondary" onclick="closeAddFacultyModal()">ƒ∞ptal</button>
                </div>
            </form>
        </div>
    </div>

   <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Campus Summer</h3>
                    <p>T√ºrkiye'nin en kapsamlƒ± yaz dersleri takip platformu. Akademik hedeflerinize ula≈ümanƒ±n en kolay yolu.</p>
                </div>
                <div class="footer-section">
                    <h3>Hƒ±zlƒ± Baƒülantƒ±lar</h3>
                    <a href="anasayfa.html">Ana Sayfa</a>
                    <a href="../√úniversiteler/√úniversitler.html">√úniversiteler</a>
                    <a href="../Dersler/dersler.html">Dersler</a>
                    <a href="../Hakkƒ±mƒ±zda/Hakkƒ±mƒ±zda.html">Hakkƒ±mƒ±zda</a>
                </div>
                <div class="footer-section">
                    <h3>Destek</h3>                    
                    <a href="../ƒ∞leti≈üim/iletisim.html">ƒ∞leti≈üim</a>
                    <a href="../Gizlilik-politikasƒ±/gizlilikpolitikasƒ±.html">Gizlilik Politikasƒ±</a>
                    
                </div>
                <div class="footer-section">
                    <h3>ƒ∞leti≈üim</h3>
                    <p>üìß atakan.baskir@std.hku.edu.tr</p>
                    <p>üìû +90 506 536 1780</p>
                    <p>üìç Gaziantep, T√ºrkiye</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Campus Summer. T√ºm haklarƒ± saklƒ±dƒ±r.</p>
            </div>
        </div>
   </footer>
    
    <script>
        const API_URL = 'http://localhost:5500/api';
        let allFaculties = [];
        let isAcademician = false;
        let isAdmin = false;
        let currentUser = null;

        // Sayfa y√ºklendiƒüinde
        document.addEventListener('DOMContentLoaded', function() {
            checkAuth();
            loadFaculties();
            
            // "Fak√ºlte Ekle" butonuna event listener ekle
            document.getElementById('addFacultyBtnTop')?.addEventListener('click', openAddFacultyModalTop);
        });

        // Kullanƒ±cƒ± kimlik doƒürulamasƒ±nƒ± kontrol et
        function checkAuth() {
            const token = localStorage.getItem('token');
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            currentUser = user;
            
            // Admin kontrol√º
            if (token && user.userType === 'admin') {
                isAdmin = true;
            }
            
            // Akademisyen kontrol√º ve fak√ºlte ekle butonu g√∂ster
            if (token && user.userType === 'academician') {
                isAcademician = true;
                document.getElementById('addFacultyBtnTop').style.display = 'inline-flex';
                
                // √úniversite bilgisini g√∂ster
                if (user.universityName) {
                    document.getElementById('universityInfoText').textContent = 
                        `${user.universityName} - Fak√ºlteler`;
                }
            }
        }

        // Fak√ºlteleri y√ºkle
        async function loadFaculties() {
            try {
                const token = localStorage.getItem('token');
                
                // Akademisyen ise sadece kendi √ºniversitesinin fak√ºltelerini getir
                let url = `${API_URL}/faculties`;
                if (isAcademician && currentUser.universityId) {
                    url += `?universityId=${currentUser.universityId}`;
                }
                
                const response = await fetch(url, {
                    headers: token ? {
                        'Authorization': `Bearer ${token}`
                    } : {}
                });
                const data = await response.json();
                
                if (data.success) {
                    allFaculties = data.faculties;
                    displayFaculties(allFaculties);
                } else {
                    displayFaculties([]);
                }
            } catch (error) {
                console.error('Fak√ºlteler y√ºklenirken hata:', error);
                displayFaculties([]);
            }
        }

        // Fak√ºlteleri g√∂ster
        function displayFaculties(faculties) {
            const grid = document.getElementById('facultiesGrid');
            grid.innerHTML = '';

            // Fak√ºlte sayƒ±sƒ±nƒ± g√ºncelle
            document.getElementById('facultyCount').textContent = faculties.length;

            if (faculties.length === 0) {
                grid.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 3rem;">
                        <p style="font-size: 1.2rem; color: #666; margin-bottom: 1rem;">Hen√ºz fak√ºlte eklenmemi≈ü.</p>
                        ${isAcademician ? '<p style="color: #999;">Yeni fak√ºlte eklemek i√ßin yukarƒ±daki butona tƒ±klayƒ±n.</p>' : ''}
                    </div>
                `;
                return;
            }

            faculties.forEach(faculty => {
                const card = createFacultyCard(faculty);
                grid.appendChild(card);
            });
        }

        // Fak√ºlte kartƒ± olu≈ütur
        function createFacultyCard(faculty) {
            const card = document.createElement('div');
            card.className = 'fakulte-card';

            // Kƒ±saltma olu≈ütur
            const shortName = faculty.name.split(' ').map(word => word[0]).join('').toUpperCase().substring(0, 3);

            // Sadece akademisyen kendi eklediƒüi fak√ºlteleri silebilir
            const showDeleteBtn = isAcademician;

            card.innerHTML = `
                ${showDeleteBtn ? `<button class="delete-btn" onclick="deleteFaculty(${faculty.id}, '${faculty.name}')" title="Fak√ºlteyi Sil">üóëÔ∏è</button>` : ''}
                <div class="fakulte-logo">
                    <span>${shortName}</span>
                </div>
                <h3>${faculty.name}</h3>
                ${faculty.description ? `<p class="fakulte-description">${faculty.description}</p>` : ''}
                ${faculty.academician_name ? `<p class="fakulte-academician">üë§ ${faculty.academician_name}</p>` : ''}
                <p class="fakulte-date">üìÖ ${new Date(faculty.created_at).toLocaleDateString('tr-TR')}</p>
            `;

            return card;
        }

        // Fak√ºlte ekleme modalƒ±nƒ± a√ß (√ºst butondan)
        function openAddFacultyModalTop() {
            if (currentUser.universityId && currentUser.universityName) {
                document.getElementById('facultyUniversityId').value = currentUser.universityId;
                document.getElementById('facultyUniversityName').textContent = `√úniversite: ${currentUser.universityName}`;
                document.getElementById('addFacultyModal').style.display = 'flex';
            } else {
                alert('√úniversite bilginiz eksik. L√ºtfen tekrar giri≈ü yapƒ±n.');
            }
        }

        // Fak√ºlte ekleme modalƒ±nƒ± kapat
        function closeAddFacultyModal() {
            document.getElementById('addFacultyModal').style.display = 'none';
            document.getElementById('addFacultyForm').reset();
        }

        // Fak√ºlte ekle
        async function addFaculty(event) {
            event.preventDefault();
            
            const token = localStorage.getItem('token');
            if (!token) {
                alert('L√ºtfen √∂nce giri≈ü yapƒ±n');
                return;
            }

            const universityId = document.getElementById('facultyUniversityId').value;
            const facultyName = document.getElementById('facultyName').value;
            const facultyDescription = document.getElementById('facultyDescription').value;

            try {
                const response = await fetch(`${API_URL}/faculties`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        universityId: parseInt(universityId),
                        name: facultyName,
                        description: facultyDescription || null
                    })
                });

                const data = await response.json();

                if (data.success) {
                    alert('Fak√ºlte ba≈üarƒ±yla eklendi!');
                    closeAddFacultyModal();
                    loadFaculties(); // Listeyi yenile
                } else {
                    alert('Hata: ' + data.message);
                }
            } catch (error) {
                console.error('Fak√ºlte eklenirken hata:', error);
                alert('Fak√ºlte eklenirken bir hata olu≈ütu');
            }
        }

        // Fak√ºlte sil
        async function deleteFaculty(id, name) {
            if (!confirm(`"${name}" fak√ºltesini silmek istediƒüinizden emin misiniz?`)) {
                return;
            }

            const token = localStorage.getItem('token');
            if (!token) {
                alert('L√ºtfen √∂nce giri≈ü yapƒ±n');
                return;
            }

            try {
                const response = await fetch(`${API_URL}/faculties/${id}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const data = await response.json();

                if (data.success) {
                    alert('Fak√ºlte ba≈üarƒ±yla silindi!');
                    loadFaculties(); // Listeyi yenile
                } else {
                    alert('Hata: ' + data.message);
                }
            } catch (error) {
                console.error('Fak√ºlte silinirken hata:', error);
                alert('Fak√ºlte silinirken bir hata olu≈ütu');
            }
        }

        // Modal dƒ±≈üƒ±na tƒ±klanƒ±nca kapat
        window.onclick = function(event) {
            const addFacultyModal = document.getElementById('addFacultyModal');
            
            if (event.target === addFacultyModal) {
                closeAddFacultyModal();
            }
        }
    </script>

</body>
</html>